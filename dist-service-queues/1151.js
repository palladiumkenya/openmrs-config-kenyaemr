"use strict";(globalThis.webpackChunk_openmrs_esm_service_queues_app=globalThis.webpackChunk_openmrs_esm_service_queues_app||[]).push([[1151],{31151:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(90380),a=n.n(r),o=n(93150),i=n(97355),u=n(56974);const l=function(e){var t=e.queueEntry,n=e.closeModal,r=(0,o.useTranslation)().t,l=t.display,s=t.queue.display,c=a().createElement(o.Trans,{i18nKey:"confirmRemovePatientFromQueue"},"Are you sure you want to remove ",a().createElement("strong",null,{patient:l})," from ",{queue:s},"?");return a().createElement(u.A,{queueEntry:t,closeModal:n,modalParams:{modalTitle:r("removePatientFromQueue","Remove {{patient}} from queue?",{patient:t.display}),modalInstruction:c,submitButtonText:r("remove","Remove"),submitSuccessTitle:r("patientRemoved","Patient removed"),submitSuccessText:r("patientRemovedSuccessfully","Patient removed from queue successfully"),submitFailureTitle:r("patientRemovedFailed","Error removing patient from queue"),submitAction:function(e){return(0,i.hC)(e.uuid,{endedAt:(new Date).toISOString()})}},showPatientName:!1})}},42853:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(43944);const a=function(e,t){return(0,r.A)(e,t)}},51751:(e,t,n)=>{n.d(t,{Mu:()=>h,Z0:()=>p,fe:()=>y});var r=n(90380),a=n(42853),o=n(71123),i=n(55434),u=n(38254);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw a}}return o}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}var m="".concat(u.restBaseUrl,"/queue-entry"),f="custom:(uuid,display,queue,status,patient:(uuid,display,person,identifiers:(uuid,display,identifier,identifierType)),visit:(uuid,display,startDatetime,encounters:(uuid,display,diagnoses,encounterDatetime,encounterType,obs,encounterProviders,voided),attributes:(uuid,display,value,attributeType)),priority,priorityComment,sortWeight,startedAt,endedAt,locationWaitingFor,queueComingFrom,providerWaitingFor,previousQueueEntry)";function v(e,t){var n=new URLSearchParams;if(n.append("v",e),n.append("totalCount","true"),t){var r=!0,a=!1,o=void 0;try{for(var i,u=Object.entries(t)[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var l=s(i.value,2),c=l[0],d=l[1];null!=d&&n.append(c,null==d?void 0:d.toString())}}catch(e){a=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}}return"".concat(m,"?").concat(n.toString())}function y(){var e=(0,i.useSWRConfig)().mutate;return{mutateQueueEntries:function(){return e(function(e){return"string"==typeof e&&(e.includes("".concat(u.restBaseUrl,"/queue-entry"))||e.includes("".concat(u.restBaseUrl,"/visit-queue-entry")))}).then(function(){window.dispatchEvent(new CustomEvent("queue-entry-updated"))})}}}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f,n=y().mutateQueueEntries,i=s((0,r.useState)(0),2),l=i[0],d=i[1],m=s((0,r.useState)(t),2),p=m[0],h=m[1],g=s((0,r.useState)(e),2),b=g[0],S=g[1],E=s((0,r.useState)([]),2),w=E[0],T=E[1],A=s((0,r.useState)(void 0),2),C=A[0],q=A[1],k=s((0,r.useState)(v(p,b)),2),F=k[0],U=k[1],j=s((0,r.useState)(0),2),R=j[0],P=j[1],I=s((0,r.useState)(!1),2),x=I[0],B=I[1],L=(0,r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;B(!0),d(0),U(v(e,t))},[p,b]);(0,r.useEffect)(function(){var n=!(0,a.A)(b,e),r=p!==t;(n||r)&&(n&&S(e),r&&h(t),L(t,e))},[p,b,L,t,e,S]);var O=(0,o.Ay)(F,u.openmrsFetch),_=O.data,M=O.isValidating,Q=O.error;(0,r.useEffect)(function(){var e=function(e){var t,n,r=null==e||null===(n=e.data)||void 0===n||null===(t=n.links)||void 0===t?void 0:t.find(function(e){return"next"===e.rel});if(r){var a=new URL(r.uri);return a.origin===window.location.origin?a.toString():new URL("".concat(a.pathname).concat(a.search?a.search:""),window.location.origin).toString()}return null}(_),t=x&&!M;if(x&&M&&B(!1),_&&!M&&!t){var n,r,a,o;if((null==_||null===(n=_.data)||void 0===n?void 0:n.totalCount)>-1&&(null==_||null===(r=_.data)||void 0===r?void 0:r.totalCount)!==R&&P(null==_||null===(o=_.data)||void 0===o?void 0:o.totalCount),null==_||null===(a=_.data)||void 0===a?void 0:a.results){var i,u=c(w);u[l]=null==_||null===(i=_.data)||void 0===i?void 0:i.results,T(u)}d(l+1),U(e),w.length>l&&e&&B(!0)}e||w.length>l+1&&T(function(e){var t=c(e);return t.splice(l+1),t})},[_,w,l,R,x,M]),(0,r.useEffect)(function(){Q&&q(Q)},[Q]);var D=(0,r.useCallback)(function(){L()},[L]);(0,r.useEffect)(function(){return window.addEventListener("queue-entry-updated",D),function(){window.removeEventListener("queue-entry-updated",D)}},[D]);var W=(0,r.useMemo)(function(){return w.flat()},[w]);return{queueEntries:W,totalCount:R,isLoading:void 0===R||R&&W.length<R,isValidating:M||l<w.length,error:C,mutate:n}}function h(e){var t,n,r=new URLSearchParams,a=!0,i=!1,l=void 0;try{for(var c,d=Object.entries(e)[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var m=s(c.value,2),f=m[0],v=m[1];null!=v&&r.append(f,null==v?void 0:v.toString())}}catch(e){i=!0,l=e}finally{try{a||null==d.return||d.return()}finally{if(i)throw l}}var y="".concat(u.restBaseUrl,"/queue-entry-metrics?")+r.toString(),p=(0,o.Ay)(y,u.openmrsFetch).data;return{count:p?null==p||null===(t=p.data)||void 0===t?void 0:t.count:0,averageWaitTime:null==p||null===(n=p.data)||void 0===n?void 0:n.averageWaitTime}}},56974:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(90380),a=n.n(r),o=n(93150),i=n(85689),u=n(38254),l=n(51751);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const c=function(e){var t,n,c=e.queueEntry,d=e.closeModal,m=e.modalParams,f=e.showPatientName,v=(0,o.useTranslation)().t,y=(0,l.fe)().mutateQueueEntries,p=m.modalTitle,h=m.modalInstruction,g=m.submitButtonText,b=m.submitSuccessTitle,S=m.submitSuccessText,E=m.submitFailureTitle,w=m.submitAction,T=(t=(0,r.useState)(!1),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw a}}return o}}(t,n)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),A=T[0],C=T[1];return a().createElement(a().Fragment,null,a().createElement(i.rQ0,{closeModal:d,title:p}),a().createElement(i.cwr,null,f?a().createElement(i.BJc,{gap:4},a().createElement("h5",null,c.display),a().createElement("span",null,h)):a().createElement("p",null,h)),a().createElement(i.jlY,null,a().createElement(i.$nd,{kind:"secondary",onClick:d},v("cancel","Cancel")),a().createElement(i.$nd,{kind:"danger",disabled:A,onClick:function(e){e.preventDefault(),C(!0),w(c).then(function(e){var t=e.status;if(!(t>=200&&t<300))throw{message:v("unexpectedServerResponse","Unexpected Server Response")};(0,u.showSnackbar)({isLowContrast:!0,title:b,kind:"success",subtitle:S}),y(),d()}).catch(function(e){(0,u.showSnackbar)({title:E,kind:"error",subtitle:null==e?void 0:e.message})}).finally(function(){C(!1)})}},g)))}},97355:(e,t,n)=>{n.d(t,{OR:()=>u,TI:()=>a,g$:()=>i,hC:()=>o});var r=n(38254);function a(e,t){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/transition"),{method:"POST",headers:{"Content-Type":"application/json"},signal:null==t?void 0:t.signal,body:e})}function o(e,t,n){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},signal:null==n?void 0:n.signal,body:t})}function i(e,t){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/transition"),{method:"DELETE",headers:{"Content-Type":"application/json"},signal:null==t?void 0:t.signal,body:e})}function u(e,t){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},signal:null==t?void 0:t.signal})}}}]);