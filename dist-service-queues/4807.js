"use strict";(globalThis.webpackChunk_openmrs_esm_service_queues_app=globalThis.webpackChunk_openmrs_esm_service_queues_app||[]).push([[4807],{1677:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(96956),u=n(84089),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;const a=function(e,t){if((0,r.A)(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!(0,u.A)(e))||i.test(e)||!o.test(e)||null!=t&&e in Object(t)}},9322:(e,t,n)=>{n.d(t,{A:()=>u});var r=n(84089);const u=function(e){if("string"==typeof e||(0,r.A)(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},14151:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e){return e}},24807:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var r=n(90380),u=n.n(r),o=n(93150),i=n(85689),a=n(38254),l=n(8050),c=n(30345),s=n(61031),f=n(51751),d=n(36505);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function p(){var e,t=(0,o.useTranslation)().t,n=(0,a.useLayoutType)(),p=(0,c.Q3)(),m=(0,c.RI)(),g=(0,d.A)().services,h=(0,s.vW)(null==p?void 0:p.serviceUuid,m).serviceCount,b={display:"".concat(t("all","All"))},A=[b].concat(function(e){if(Array.isArray(e))return v(e)}(e=null!=g?g:[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),S=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,u,o=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){a=!0,u=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw u}}return o}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((0,r.useState)(function(){return!(null==p?void 0:p.serviceDisplay)||!(null==p?void 0:p.serviceUuid)}),2),w=S[0],q=S[1],U=(0,f.Z0)({service:null==p?void 0:p.serviceUuid,location:m,isEnded:!1}),L=U.totalCount,O=U.queueEntries.filter(function(e){var t,n;return"urgent"===(null===(n=e.priority)||void 0===n||null===(t=n.display)||void 0===t?void 0:t.toLowerCase())}).length;return u().createElement(l.A,{headerLabel:"",label:t("patients","Patients"),locationUuid:m,service:null==p?void 0:p.serviceDisplay,serviceUuid:null==p?void 0:p.serviceUuid,value:w?null!=L?L:"--":h,showUrgent:O>0,urgentCount:O},u().createElement(i.msM,{id:"inline",initialSelectedItem:b,items:A,itemToString:function(e){var t;return e?"".concat(e.display," ").concat((null===(t=e.location)||void 0===t?void 0:t.display)?"- ".concat(e.location.display):""):""},label:"",onChange:function(e){var t=e.selectedItem;(0,c.YR)(t.uuid,t.display),void 0===t.uuid?q(!0):q(!1)},size:(0,a.isDesktop)(n)?"sm":"lg",titleText:"".concat(t("waitingFor","Waiting for"),":"),type:"inline"}))}},30345:(e,t,n)=>{n.d(t,{D5:()=>A,E9:()=>h,Q3:()=>q,RI:()=>L,YR:()=>g,g4:()=>j,i6:()=>b,lM:()=>U,rH:()=>S,yn:()=>w,zv:()=>O});var r=n(38254);function u(e,t){null==t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t)}function o(e){return sessionStorage.getItem(e)}var i={queueLocationName:o("queueLocationName")},a={queueLocationUuid:o("queueLocationUuid")},l={serviceUuid:o("queueServiceUuid"),serviceDisplay:o("queueServiceDisplay")},c={statusUuid:o("queueStatusUuid"),statusDisplay:o("queueStatusDisplay")},s={providerQueueRoomTimestamp:new Date},f={isPermanentProviderQueueRoom:o("isPermanentProviderQueueRoom")};function d(){return(0,r.getGlobalStore)("queueSelectedServiceUuid",l)}function v(){return(0,r.getGlobalStore)("queueLocationNameSelected",i)}function y(){return(0,r.getGlobalStore)("queueLocationUuidSelected",a)}function p(){return(0,r.getGlobalStore)("queueStatusUuidSelected",c)}function m(){return(0,r.getGlobalStore)("isPermanentProviderQueueRoom",f)}var g=function(e,t){var n=d();u("queueServiceDisplay",t),u("queueServiceUuid",e),n.setState({serviceUuid:e,serviceDisplay:t})},h=function(e){var t=v();u("queueLocationName",e),t.setState({queueLocationName:e})},b=function(e){var t=y();u("queueLocationUuid",e),t.setState({queueLocationUuid:e})},A=function(e){(0,r.getGlobalStore)("queueProviderRoomTimestamp",s).setState({providerQueueRoomTimestamp:e})},S=function(e){var t=m();u("isPermanentProviderQueueRoom",e),t.setState({isPermanentProviderQueueRoom:e})},w=function(e,t){var n=p();u("queueStatusUuid",e),u("queueStatusDisplay",t),n.setState({statusUuid:e,statusDisplay:t})},q=function(){return(0,r.useStore)(d())},U=function(){return(0,r.useStore)(v()).queueLocationName},L=function(){return(0,r.useStore)(y()).queueLocationUuid},O=function(){return(0,r.useStore)(m()).isPermanentProviderQueueRoom},j=function(){return(0,r.useStore)(p())}},36505:(e,t,n)=>{n.d(t,{A:()=>k});var r=n(38254),u=n(90380),o=n(50942),i=n(39791),a=n(43944);var l=n(97942);const c=function(e){return e==e&&!(0,l.A)(e)};var s=n(7817);const f=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},d=function(e){var t=function(e){for(var t=(0,s.A)(e),n=t.length;n--;){var r=t[n],u=e[r];t[n]=[r,u,c(u)]}return t}(e);return 1==t.length&&t[0][2]?f(t[0][0],t[0][1]):function(n){return n===e||function(e,t,n,r){var u=n.length,o=u,l=!r;if(null==e)return!o;for(e=Object(e);u--;){var c=n[u];if(l&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++u<o;){var s=(c=n[u])[0],f=e[s],d=c[1];if(l&&c[2]){if(void 0===f&&!(s in e))return!1}else{var v=new i.A;if(r)var y=r(f,d,s,e,t,v);if(!(void 0===y?(0,a.A)(d,f,3,r,v):y))return!1}}return!0}(n,e,t)}};var v=n(55841);const y=function(e,t){return null!=e&&t in Object(e)};var p=n(85861),m=n(61697),g=n(96956),h=n(85378),b=n(47893),A=n(9322);const S=function(e,t){return null!=e&&function(e,t,n){for(var r=-1,u=(t=(0,p.A)(t,e)).length,o=!1;++r<u;){var i=(0,A.A)(t[r]);if(!(o=null!=e&&n(e,i)))break;e=e[i]}return o||++r!=u?o:!!(u=null==e?0:e.length)&&(0,b.A)(u)&&(0,h.A)(i,u)&&((0,g.A)(e)||(0,m.A)(e))}(e,t,y)};var w=n(1677);const q=function(e,t){return(0,w.A)(e)&&c(t)?f((0,A.A)(e),t):function(n){var r=function(e,t,n){var r=null==e?void 0:(0,v.A)(e,t);return void 0===r?n:r}(n,e);return void 0===r&&r===t?S(n,e):(0,a.A)(t,r,3)}};var U=n(14151);const L=function(e){return(0,w.A)(e)?(t=(0,A.A)(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return(0,v.A)(t,e)}}(e);var t};var O=n(34149);const j=function(e){return e!=e},C=function(e,t){return!(null==e||!e.length)&&function(e,t,n){return t==t?function(e,t,n){for(var r=n-1,u=e.length;++r<u;)if(e[r]===t)return r;return-1}(e,t,n):function(e,t,n,r){for(var u=e.length,o=n+(r?1:-1);r?o--:++o<u;)if(t(e[o],o,e))return o;return-1}(e,j,n)}(e,t,0)>-1},E=function(e,t,n){for(var r=-1,u=null==e?0:e.length;++r<u;)if(n(t,e[r]))return!0;return!1};var P=n(62026),I=n(28574);var R=n(39922);const T=I.A&&1/(0,R.A)(new I.A([,-0]))[1]==1/0?function(e){return new I.A(e)}:function(){},D=function(e,t){return e&&e.length?function(e,t,n){var r=-1,u=C,o=e.length,i=!0,a=[],l=a;if(n)i=!1,u=E;else if(o>=200){var c=t?null:T(e);if(c)return(0,R.A)(c);i=!1,u=P.A,l=new O.A}else l=t?[]:a;e:for(;++r<o;){var s=e[r],f=t?t(s):s;if(s=n||0!==s?s:0,i&&f==f){for(var d=l.length;d--;)if(l[d]===f)continue e;t&&l.push(f),a.push(s)}else u(l,f,n)||(l!==a&&l.push(f),a.push(s))}return a}(e,"function"==typeof(n=t)?n:null==n?U.A:"object"==typeof n?(0,g.A)(n)?q(n[0],n[1]):d(n):L(n)):[];var n};var Q=n(30345);const k=function(){var e=(0,Q.RI)(),t=(0,o.A)(e),n=t.queues,i=t.isLoading;return(0,u.useMemo)(function(){return{services:D(n.flatMap(function(e){return e.service}),function(e){return null==e?void 0:e.uuid}).sort(function(e,t){return e.display.localeCompare(t.display,(0,r.getLocale)())}),isLoadingQueueServices:i}},[n,i])}},42853:(e,t,n)=>{n.d(t,{A:()=>u});var r=n(43944);const u=function(e,t){return(0,r.A)(e,t)}},50942:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(38254),u=n(88010),o=n.n(u),i=n(90380);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){var t,n="".concat(r.restBaseUrl,"/queue?v=").concat("custom:(uuid,display,name,description,service:(uuid,display),allowedPriorities:(uuid,display),allowedStatuses:(uuid,display),location:(uuid,display))")+(e?"&location=".concat(e):""),u=o()(n,r.openmrsFetch),l=u.data,c=function(e,t){if(null==e)return{};var n,r,u=function(e,t){if(null==e)return{};var n,r,u={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(u[n]=e[n]);return u}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}(u,["data"]),s=(0,i.useMemo)(function(){var e,t;return null!==(t=null==l||null===(e=l.data)||void 0===e?void 0:e.results.sort(function(e,t){return e.display.localeCompare(t.display,(0,r.getLocale)())}))&&void 0!==t?t:[]},[null==l||null===(t=l.data)||void 0===t?void 0:t.results]);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}({queues:s},c)}},51751:(e,t,n)=>{n.d(t,{Mu:()=>g,Z0:()=>m,fe:()=>p});var r=n(90380),u=n(42853),o=n(71123),i=n(55434),a=n(38254);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,u,o=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){a=!0,u=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw u}}return o}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}var d="".concat(a.restBaseUrl,"/queue-entry"),v="custom:(uuid,display,queue,status,patient:(uuid,display,person,identifiers:(uuid,display,identifier,identifierType)),visit:(uuid,display,startDatetime,encounters:(uuid,display,diagnoses,encounterDatetime,encounterType,obs,encounterProviders,voided),attributes:(uuid,display,value,attributeType)),priority,priorityComment,sortWeight,startedAt,endedAt,locationWaitingFor,queueComingFrom,providerWaitingFor,previousQueueEntry)";function y(e,t){var n=new URLSearchParams;if(n.append("v",e),n.append("totalCount","true"),t){var r=!0,u=!1,o=void 0;try{for(var i,a=Object.entries(t)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var l=c(i.value,2),s=l[0],f=l[1];null!=f&&n.append(s,null==f?void 0:f.toString())}}catch(e){u=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(u)throw o}}}return"".concat(d,"?").concat(n.toString())}function p(){var e=(0,i.useSWRConfig)().mutate;return{mutateQueueEntries:function(){return e(function(e){return"string"==typeof e&&(e.includes("".concat(a.restBaseUrl,"/queue-entry"))||e.includes("".concat(a.restBaseUrl,"/visit-queue-entry")))}).then(function(){window.dispatchEvent(new CustomEvent("queue-entry-updated"))})}}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,n=p().mutateQueueEntries,i=c((0,r.useState)(0),2),l=i[0],f=i[1],d=c((0,r.useState)(t),2),m=d[0],g=d[1],h=c((0,r.useState)(e),2),b=h[0],A=h[1],S=c((0,r.useState)([]),2),w=S[0],q=S[1],U=c((0,r.useState)(void 0),2),L=U[0],O=U[1],j=c((0,r.useState)(y(m,b)),2),C=j[0],E=j[1],P=c((0,r.useState)(0),2),I=P[0],R=P[1],T=c((0,r.useState)(!1),2),D=T[0],Q=T[1],k=(0,r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;Q(!0),f(0),E(y(e,t))},[m,b]);(0,r.useEffect)(function(){var n=!(0,u.A)(b,e),r=m!==t;(n||r)&&(n&&A(e),r&&g(t),k(t,e))},[m,b,k,t,e,A]);var _=(0,o.Ay)(C,a.openmrsFetch),x=_.data,M=_.isValidating,W=_.error;(0,r.useEffect)(function(){var e=function(e){var t,n,r=null==e||null===(n=e.data)||void 0===n||null===(t=n.links)||void 0===t?void 0:t.find(function(e){return"next"===e.rel});if(r){var u=new URL(r.uri);return u.origin===window.location.origin?u.toString():new URL("".concat(u.pathname).concat(u.search?u.search:""),window.location.origin).toString()}return null}(x),t=D&&!M;if(D&&M&&Q(!1),x&&!M&&!t){var n,r,u,o;if((null==x||null===(n=x.data)||void 0===n?void 0:n.totalCount)>-1&&(null==x||null===(r=x.data)||void 0===r?void 0:r.totalCount)!==I&&R(null==x||null===(o=x.data)||void 0===o?void 0:o.totalCount),null==x||null===(u=x.data)||void 0===u?void 0:u.results){var i,a=s(w);a[l]=null==x||null===(i=x.data)||void 0===i?void 0:i.results,q(a)}f(l+1),E(e),w.length>l&&e&&Q(!0)}e||w.length>l+1&&q(function(e){var t=s(e);return t.splice(l+1),t})},[x,w,l,I,D,M]),(0,r.useEffect)(function(){W&&O(W)},[W]);var F=(0,r.useCallback)(function(){k()},[k]);(0,r.useEffect)(function(){return window.addEventListener("queue-entry-updated",F),function(){window.removeEventListener("queue-entry-updated",F)}},[F]);var G=(0,r.useMemo)(function(){return w.flat()},[w]);return{queueEntries:G,totalCount:I,isLoading:void 0===I||I&&G.length<I,isValidating:M||l<w.length,error:L,mutate:n}}function g(e){var t,n,r=new URLSearchParams,u=!0,i=!1,l=void 0;try{for(var s,f=Object.entries(e)[Symbol.iterator]();!(u=(s=f.next()).done);u=!0){var d=c(s.value,2),v=d[0],y=d[1];null!=y&&r.append(v,null==y?void 0:y.toString())}}catch(e){i=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(i)throw l}}var p="".concat(a.restBaseUrl,"/queue-entry-metrics?")+r.toString(),m=(0,o.Ay)(p,a.openmrsFetch).data;return{count:m?null==m||null===(t=m.data)||void 0===t?void 0:t.count:0,averageWaitTime:null==m||null===(n=m.data)||void 0===n?void 0:n.averageWaitTime}}},55841:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(85861),u=n(9322);const o=function(e,t){for(var n=0,o=(t=(0,r.A)(t,e)).length;null!=e&&n<o;)e=e[(0,u.A)(t[n++])];return n&&n==o?e:void 0}},60587:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(83516),u=n(65133),o=n(96956),i=n(84089),a=r.A?r.A.prototype:void 0,l=a?a.toString:void 0;const c=function e(t){if("string"==typeof t)return t;if((0,o.A)(t))return(0,u.A)(t,e)+"";if((0,i.A)(t))return l?l.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n},s=function(e){return null==e?"":c(e)}},65133:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e,t){for(var n=-1,r=null==e?0:e.length,u=Array(r);++n<r;)u[n]=t(e[n],n,e);return u}},84089:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(62135),u=n(47313);const o=function(e){return"symbol"==typeof e||(0,u.A)(e)&&"[object Symbol]"==(0,r.A)(e)}},85861:(e,t,n)=>{n.d(t,{A:()=>v});var r=n(96956),u=n(1677),o=n(29240);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,u=t?t.apply(this,r):r[0],o=n.cache;if(o.has(u))return o.get(u);var i=e.apply(this,r);return n.cache=o.set(u,i)||o,i};return n.cache=new(i.Cache||o.A),n}i.Cache=o.A;var a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/\\(\\)?/g;const c=(s=i(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(a,function(e,n,r,u){t.push(r?u.replace(l,"$1"):n||e)}),t},function(e){return 500===f.size&&f.clear(),e}),f=s.cache,s);var s,f,d=n(60587);const v=function(e,t){return(0,r.A)(e)?e:(0,u.A)(e,t)?[e]:c((0,d.A)(e))}}}]);