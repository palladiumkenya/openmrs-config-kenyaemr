"use strict";(globalThis.webpackChunk_openmrs_esm_service_queues_app=globalThis.webpackChunk_openmrs_esm_service_queues_app||[]).push([[8561],{42853:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(43944);const a=function(t,e){return(0,r.A)(t,e)}},51751:(t,e,n)=>{n.d(e,{Mu:()=>h,Z0:()=>p,fe:()=>y});var r=n(90380),a=n(42853),u=n(71123),o=n(55434),i=n(38254);function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,u=[],o=!0,i=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(u.push(r.value),!e||u.length!==e);o=!0);}catch(t){i=!0,a=t}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return u}}(t,e)||d(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||d(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}var f="".concat(i.restBaseUrl,"/queue-entry"),m="custom:(uuid,display,queue,status,patient:(uuid,display,person,identifiers:(uuid,display,identifier,identifierType)),visit:(uuid,display,startDatetime,encounters:(uuid,display,diagnoses,encounterDatetime,encounterType,obs,encounterProviders,voided),attributes:(uuid,display,value,attributeType)),priority,priorityComment,sortWeight,startedAt,endedAt,locationWaitingFor,queueComingFrom,providerWaitingFor,previousQueueEntry)";function v(t,e){var n=new URLSearchParams;if(n.append("v",t),n.append("totalCount","true"),e){var r=!0,a=!1,u=void 0;try{for(var o,i=Object.entries(e)[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=s(o.value,2),c=l[0],d=l[1];null!=d&&n.append(c,null==d?void 0:d.toString())}}catch(t){a=!0,u=t}finally{try{r||null==i.return||i.return()}finally{if(a)throw u}}}return"".concat(f,"?").concat(n.toString())}function y(){var t=(0,o.useSWRConfig)().mutate;return{mutateQueueEntries:function(){return t(function(t){return"string"==typeof t&&(t.includes("".concat(i.restBaseUrl,"/queue-entry"))||t.includes("".concat(i.restBaseUrl,"/visit-queue-entry")))}).then(function(){window.dispatchEvent(new CustomEvent("queue-entry-updated"))})}}}function p(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,n=y().mutateQueueEntries,o=s((0,r.useState)(0),2),l=o[0],d=o[1],f=s((0,r.useState)(e),2),p=f[0],h=f[1],g=s((0,r.useState)(t),2),b=g[0],S=g[1],E=s((0,r.useState)([]),2),w=E[0],T=E[1],A=s((0,r.useState)(void 0),2),q=A[0],C=A[1],U=s((0,r.useState)(v(p,b)),2),k=U[0],F=U[1],j=s((0,r.useState)(0),2),B=j[0],x=j[1],I=s((0,r.useState)(!1),2),L=I[0],M=I[1],P=(0,r.useCallback)(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;M(!0),d(0),F(v(t,e))},[p,b]);(0,r.useEffect)(function(){var n=!(0,a.A)(b,t),r=p!==e;(n||r)&&(n&&S(t),r&&h(e),P(e,t))},[p,b,P,e,t,S]);var _=(0,u.Ay)(k,i.openmrsFetch),O=_.data,Q=_.isValidating,R=_.error;(0,r.useEffect)(function(){var t=function(t){var e,n,r=null==t||null===(n=t.data)||void 0===n||null===(e=n.links)||void 0===e?void 0:e.find(function(t){return"next"===t.rel});if(r){var a=new URL(r.uri);return a.origin===window.location.origin?a.toString():new URL("".concat(a.pathname).concat(a.search?a.search:""),window.location.origin).toString()}return null}(O),e=L&&!Q;if(L&&Q&&M(!1),O&&!Q&&!e){var n,r,a,u;if((null==O||null===(n=O.data)||void 0===n?void 0:n.totalCount)>-1&&(null==O||null===(r=O.data)||void 0===r?void 0:r.totalCount)!==B&&x(null==O||null===(u=O.data)||void 0===u?void 0:u.totalCount),null==O||null===(a=O.data)||void 0===a?void 0:a.results){var o,i=c(w);i[l]=null==O||null===(o=O.data)||void 0===o?void 0:o.results,T(i)}d(l+1),F(t),w.length>l&&t&&M(!0)}t||w.length>l+1&&T(function(t){var e=c(t);return e.splice(l+1),e})},[O,w,l,B,L,Q]),(0,r.useEffect)(function(){R&&C(R)},[R]);var W=(0,r.useCallback)(function(){P()},[P]);(0,r.useEffect)(function(){return window.addEventListener("queue-entry-updated",W),function(){window.removeEventListener("queue-entry-updated",W)}},[W]);var $=(0,r.useMemo)(function(){return w.flat()},[w]);return{queueEntries:$,totalCount:B,isLoading:void 0===B||B&&$.length<B,isValidating:Q||l<w.length,error:q,mutate:n}}function h(t){var e,n,r=new URLSearchParams,a=!0,o=!1,l=void 0;try{for(var c,d=Object.entries(t)[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var f=s(c.value,2),m=f[0],v=f[1];null!=v&&r.append(m,null==v?void 0:v.toString())}}catch(t){o=!0,l=t}finally{try{a||null==d.return||d.return()}finally{if(o)throw l}}var y="".concat(i.restBaseUrl,"/queue-entry-metrics?")+r.toString(),p=(0,u.Ay)(y,i.openmrsFetch).data;return{count:p?null==p||null===(e=p.data)||void 0===e?void 0:e.count:0,averageWaitTime:null==p||null===(n=p.data)||void 0===n?void 0:n.averageWaitTime}}},56974:(t,e,n)=>{n.d(e,{A:()=>c});var r=n(90380),a=n.n(r),u=n(93150),o=n(85689),i=n(38254),l=n(51751);function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const c=function(t){var e,n,c=t.queueEntry,d=t.closeModal,f=t.modalParams,m=t.showPatientName,v=(0,u.useTranslation)().t,y=(0,l.fe)().mutateQueueEntries,p=f.modalTitle,h=f.modalInstruction,g=f.submitButtonText,b=f.submitSuccessTitle,S=f.submitSuccessText,E=f.submitFailureTitle,w=f.submitAction,T=(e=(0,r.useState)(!1),n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,u=[],o=!0,i=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(u.push(r.value),!e||u.length!==e);o=!0);}catch(t){i=!0,a=t}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return u}}(e,n)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),A=T[0],q=T[1];return a().createElement(a().Fragment,null,a().createElement(o.rQ0,{closeModal:d,title:p}),a().createElement(o.cwr,null,m?a().createElement(o.BJc,{gap:4},a().createElement("h5",null,c.display),a().createElement("span",null,h)):a().createElement("p",null,h)),a().createElement(o.jlY,null,a().createElement(o.$nd,{kind:"secondary",onClick:d},v("cancel","Cancel")),a().createElement(o.$nd,{kind:"danger",disabled:A,onClick:function(t){t.preventDefault(),q(!0),w(c).then(function(t){var e=t.status;if(!(e>=200&&e<300))throw{message:v("unexpectedServerResponse","Unexpected Server Response")};(0,i.showSnackbar)({isLowContrast:!0,title:b,kind:"success",subtitle:S}),y(),d()}).catch(function(t){(0,i.showSnackbar)({title:E,kind:"error",subtitle:null==t?void 0:t.message})}).finally(function(){q(!1)})}},g)))}},58561:(t,e,n)=>{n.r(e),n.d(e,{default:()=>l});var r=n(90380),a=n.n(r),u=n(93150),o=n(97355),i=n(56974);const l=function(t){var e=t.queueEntry,n=t.closeModal,r=(0,u.useTranslation)().t,l=e.previousQueueEntry,s=e.queueComingFrom,c=s.uuid==e.queue.uuid?a().createElement("p",null,r("confirmMoveBackStatus",'Are you sure you want to move patient back to status "{{status}}"?',{status:l.status.display,interpolation:{escapeValue:!1}})):a().createElement("p",null,r("confirmMoveBackQueueAndStatus",'Are you sure you want to move patient back to queue "{{queue}}" with status "{{status}}"?',{queue:s.display,status:l.status.display,interpolation:{escapeValue:!1}}));return a().createElement(i.A,{queueEntry:e,closeModal:n,showPatientName:!1,modalParams:{modalTitle:r("undoTransitionForPatient","Undo transition for {{patient}}",{patient:e.display}),modalInstruction:c,submitButtonText:r("undoTransition","Undo transition"),submitSuccessTitle:r("undoQueueEntryTransitionSuccess","Undo transition success"),submitSuccessText:r("queueEntryTransitionUndoSuccessful","Queue entry transition undo success"),submitFailureTitle:r("queueEntryTransitionUndoFailed","Error undoing transition"),submitAction:function(t){return(0,o.g$)({queueEntry:t.uuid})}}})}},97355:(t,e,n)=>{n.d(e,{OR:()=>i,TI:()=>a,g$:()=>o,hC:()=>u});var r=n(38254);function a(t,e){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/transition"),{method:"POST",headers:{"Content-Type":"application/json"},signal:null==e?void 0:e.signal,body:t})}function u(t,e,n){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},signal:null==n?void 0:n.signal,body:e})}function o(t,e){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/transition"),{method:"DELETE",headers:{"Content-Type":"application/json"},signal:null==e?void 0:e.signal,body:t})}function i(t,e){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/").concat(t),{method:"DELETE",headers:{"Content-Type":"application/json"},signal:null==e?void 0:e.signal})}}}]);