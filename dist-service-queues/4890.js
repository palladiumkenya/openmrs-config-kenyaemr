"use strict";(globalThis.webpackChunk_openmrs_esm_service_queues_app=globalThis.webpackChunk_openmrs_esm_service_queues_app||[]).push([[4890],{24890:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(90380),u=n.n(r),a=n(93150),o=n(97355),i=n(56974);const l=function(e){var t=e.queueEntry,n=e.closeModal,r=(0,a.useTranslation)().t,l=u().createElement("p",null,r("confirmDeleteQueueEntry","Are you sure you want to delete this queue entry?"));return u().createElement(i.A,{queueEntry:t,closeModal:n,showPatientName:!1,modalParams:{modalTitle:r("deleteQueueEntryForPatient","Delete queue entry for {{patient}}",{patient:t.display}),modalInstruction:l,submitButtonText:r("deleteQueueEntry","Delete queue entry"),submitSuccessTitle:r("queueEntryDeleteSuccessful","Queue entry deleted successfully"),submitSuccessText:r("queueEntryDeleteSuccessful","Queue entry deleted successfully"),submitFailureTitle:r("queueEntryDeleteFailed","Error deleting queue entry"),submitAction:function(e){return(0,o.OR)(e.uuid)}}})}},42853:(e,t,n)=>{n.d(t,{A:()=>u});var r=n(43944);const u=function(e,t){return(0,r.A)(e,t)}},51751:(e,t,n)=>{n.d(t,{Mu:()=>h,Z0:()=>p,fe:()=>m});var r=n(90380),u=n(42853),a=n(71123),o=n(55434),i=n(38254);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,u,a=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){i=!0,u=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw u}}return a}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}var f="".concat(i.restBaseUrl,"/queue-entry"),y="custom:(uuid,display,queue,status,patient:(uuid,display,person,identifiers:(uuid,display,identifier,identifierType)),visit:(uuid,display,startDatetime,encounters:(uuid,display,diagnoses,encounterDatetime,encounterType,obs,encounterProviders,voided),attributes:(uuid,display,value,attributeType)),priority,priorityComment,sortWeight,startedAt,endedAt,locationWaitingFor,queueComingFrom,providerWaitingFor,previousQueueEntry)";function v(e,t){var n=new URLSearchParams;if(n.append("v",e),n.append("totalCount","true"),t){var r=!0,u=!1,a=void 0;try{for(var o,i=Object.entries(t)[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=s(o.value,2),c=l[0],d=l[1];null!=d&&n.append(c,null==d?void 0:d.toString())}}catch(e){u=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(u)throw a}}}return"".concat(f,"?").concat(n.toString())}function m(){var e=(0,o.useSWRConfig)().mutate;return{mutateQueueEntries:function(){return e(function(e){return"string"==typeof e&&(e.includes("".concat(i.restBaseUrl,"/queue-entry"))||e.includes("".concat(i.restBaseUrl,"/visit-queue-entry")))}).then(function(){window.dispatchEvent(new CustomEvent("queue-entry-updated"))})}}}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y,n=m().mutateQueueEntries,o=s((0,r.useState)(0),2),l=o[0],d=o[1],f=s((0,r.useState)(t),2),p=f[0],h=f[1],g=s((0,r.useState)(e),2),b=g[0],S=g[1],E=s((0,r.useState)([]),2),w=E[0],T=E[1],A=s((0,r.useState)(void 0),2),q=A[0],C=A[1],k=s((0,r.useState)(v(p,b)),2),U=k[0],j=k[1],F=s((0,r.useState)(0),2),x=F[0],B=F[1],D=s((0,r.useState)(!1),2),I=D[0],L=D[1],O=(0,r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;L(!0),d(0),j(v(e,t))},[p,b]);(0,r.useEffect)(function(){var n=!(0,u.A)(b,e),r=p!==t;(n||r)&&(n&&S(e),r&&h(t),O(t,e))},[p,b,O,t,e,S]);var P=(0,a.Ay)(U,i.openmrsFetch),Q=P.data,_=P.isValidating,R=P.error;(0,r.useEffect)(function(){var e=function(e){var t,n,r=null==e||null===(n=e.data)||void 0===n||null===(t=n.links)||void 0===t?void 0:t.find(function(e){return"next"===e.rel});if(r){var u=new URL(r.uri);return u.origin===window.location.origin?u.toString():new URL("".concat(u.pathname).concat(u.search?u.search:""),window.location.origin).toString()}return null}(Q),t=I&&!_;if(I&&_&&L(!1),Q&&!_&&!t){var n,r,u,a;if((null==Q||null===(n=Q.data)||void 0===n?void 0:n.totalCount)>-1&&(null==Q||null===(r=Q.data)||void 0===r?void 0:r.totalCount)!==x&&B(null==Q||null===(a=Q.data)||void 0===a?void 0:a.totalCount),null==Q||null===(u=Q.data)||void 0===u?void 0:u.results){var o,i=c(w);i[l]=null==Q||null===(o=Q.data)||void 0===o?void 0:o.results,T(i)}d(l+1),j(e),w.length>l&&e&&L(!0)}e||w.length>l+1&&T(function(e){var t=c(e);return t.splice(l+1),t})},[Q,w,l,x,I,_]),(0,r.useEffect)(function(){R&&C(R)},[R]);var M=(0,r.useCallback)(function(){O()},[O]);(0,r.useEffect)(function(){return window.addEventListener("queue-entry-updated",M),function(){window.removeEventListener("queue-entry-updated",M)}},[M]);var W=(0,r.useMemo)(function(){return w.flat()},[w]);return{queueEntries:W,totalCount:x,isLoading:void 0===x||x&&W.length<x,isValidating:_||l<w.length,error:q,mutate:n}}function h(e){var t,n,r=new URLSearchParams,u=!0,o=!1,l=void 0;try{for(var c,d=Object.entries(e)[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var f=s(c.value,2),y=f[0],v=f[1];null!=v&&r.append(y,null==v?void 0:v.toString())}}catch(e){o=!0,l=e}finally{try{u||null==d.return||d.return()}finally{if(o)throw l}}var m="".concat(i.restBaseUrl,"/queue-entry-metrics?")+r.toString(),p=(0,a.Ay)(m,i.openmrsFetch).data;return{count:p?null==p||null===(t=p.data)||void 0===t?void 0:t.count:0,averageWaitTime:null==p||null===(n=p.data)||void 0===n?void 0:n.averageWaitTime}}},56974:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(90380),u=n.n(r),a=n(93150),o=n(85689),i=n(38254),l=n(51751);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const c=function(e){var t,n,c=e.queueEntry,d=e.closeModal,f=e.modalParams,y=e.showPatientName,v=(0,a.useTranslation)().t,m=(0,l.fe)().mutateQueueEntries,p=f.modalTitle,h=f.modalInstruction,g=f.submitButtonText,b=f.submitSuccessTitle,S=f.submitSuccessText,E=f.submitFailureTitle,w=f.submitAction,T=(t=(0,r.useState)(!1),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,u,a=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){i=!0,u=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw u}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),A=T[0],q=T[1];return u().createElement(u().Fragment,null,u().createElement(o.rQ0,{closeModal:d,title:p}),u().createElement(o.cwr,null,y?u().createElement(o.BJc,{gap:4},u().createElement("h5",null,c.display),u().createElement("span",null,h)):u().createElement("p",null,h)),u().createElement(o.jlY,null,u().createElement(o.$nd,{kind:"secondary",onClick:d},v("cancel","Cancel")),u().createElement(o.$nd,{kind:"danger",disabled:A,onClick:function(e){e.preventDefault(),q(!0),w(c).then(function(e){var t=e.status;if(!(t>=200&&t<300))throw{message:v("unexpectedServerResponse","Unexpected Server Response")};(0,i.showSnackbar)({isLowContrast:!0,title:b,kind:"success",subtitle:S}),m(),d()}).catch(function(e){(0,i.showSnackbar)({title:E,kind:"error",subtitle:null==e?void 0:e.message})}).finally(function(){q(!1)})}},g)))}},97355:(e,t,n)=>{n.d(t,{OR:()=>i,TI:()=>u,g$:()=>o,hC:()=>a});var r=n(38254);function u(e,t){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/transition"),{method:"POST",headers:{"Content-Type":"application/json"},signal:null==t?void 0:t.signal,body:e})}function a(e,t,n){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},signal:null==n?void 0:n.signal,body:t})}function o(e,t){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/transition"),{method:"DELETE",headers:{"Content-Type":"application/json"},signal:null==t?void 0:t.signal,body:e})}function i(e,t){return(0,r.openmrsFetch)("".concat(r.restBaseUrl,"/queue-entry/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},signal:null==t?void 0:t.signal})}}}]);