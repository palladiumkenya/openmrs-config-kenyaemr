"use strict";(globalThis.webpackChunk_openmrs_esm_service_queues_app=globalThis.webpackChunk_openmrs_esm_service_queues_app||[]).push([[1638,3728],{3728:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var n=r(90380),i=r.n(n),u=r(93150),o=r(91848),a=r(97355),l=r(90583);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const d=function(e){var t=e.queueEntry,r=e.closeModal,n=(0,u.useTranslation)().t;return i().createElement(o.A,{queueEntry:t,closeModal:r,modalParams:{modalTitle:n("movePatient","Move {{patient}}",{patient:t.display}),submitButtonText:n("move","Move"),submitSuccessTitle:n("queueEntryTransitioned","Queue entry transitioned"),submitSuccessText:n("queueEntryTransitionedSuccessfully","Queue entry transitioned successfully"),submitFailureTitle:n("queueEntryTransitionFailed","Error transitioning queue entry"),submitAction:function(e,t){var r,n,i=new Date(t.transitionDate),u=(r=(0,l.R)(t.transitionTime,t.transitionTimeFormat),n=2,function(e){if(Array.isArray(e))return e}(r)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return u}}(r,n)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=u[0],d=u[1];return i.setHours(o,d,0,0),(0,a.TI)(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){s(e,t,r[t])})}return e}({queueEntryToTransition:e.uuid,newQueue:t.selectedQueue,newStatus:t.selectedStatus,newPriority:t.selectedPriority,newPriorityComment:t.prioritycomment},t.modifyDefaultTransitionDateTime?{transitionDate:i.toISOString()}:{}))},disableSubmit:function(e,t){return t.selectedQueue==e.queue.uuid&&t.selectedStatus==e.status.uuid&&t.selectedPriority==e.priority.uuid},isEdit:!1,showQueuePicker:!0,showStatusPicker:!1}})}},21364:(e,t,r)=>{r.d(t,{A:()=>T});var n=r(90380),i=r.n(n),u=r(85689),o=r(80824),a=r(93150),l=r(68580),c=r(81160),s=r(38254);function d(e,t,r,n,i,u,o){try{var a=e[u](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function f(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var u=e.apply(t,r);function o(e){d(u,n,i,o,a,"next",e)}function a(e){d(u,n,i,o,a,"throw",e)}o(void 0)})}}function m(e,t){var r,n,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(u=0)),u;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){u.label=a[1];break}if(6===a[0]&&u.label<i[1]){u.label=i[1],i=a;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(a);break}i[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function y(e,t,r,n){return f(function(){var i;return m(this,function(u){switch(u.label){case 0:return i=new AbortController,[4,(0,s.openmrsFetch)("".concat(s.restBaseUrl,"/queue-entry-number?location=").concat(e,"&queue=").concat(r,"&visit=").concat(t,"&visitAttributeType=").concat(n),{method:"GET",headers:{"Content-Type":"application/json"},signal:i.signal})];case 1:return u.sent(),[2]}})})()}function v(e,t,r,n,i,u,o,a){return f(function(){var l;return m(this,function(c){switch(c.label){case 0:return l=new AbortController,[4,Promise.all([y(o,e,t,a)])];case 1:return c.sent(),[2,(0,s.openmrsFetch)("".concat(s.restBaseUrl,"/visit-queue-entry"),{method:"POST",headers:{"Content-Type":"application/json"},signal:l.signal,body:{visit:{uuid:e},queueEntry:{status:{uuid:i},priority:{uuid:n},queue:{uuid:t},patient:{uuid:r},startedAt:new Date,sortWeight:u}}})]}})})()}var p=r(65845),b=r(51751),h=r(66985),g=r(50942);function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function w(e,t,r,n,i,u,o){try{var a=e[u](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){q(e,t,r[t])})}return e}function P(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}const T=i().memo(function(e){var t,r,d,f=e.setOnSubmit,m=e.defaultInitialServiceQueue,y=(0,a.useTranslation)().t,q=(0,n.useMemo)(function(){return function(e){return l.Ik({queueLocation:l.Yj({required_error:e("queueLocationRequired","Queue location is required")}).trim().min(1,e("queueLocationRequired","Queue location is required")),queueService:l.Yj({required_error:e("queueServiceRequired","Queue service is required")}).trim().min(1,e("queueServiceRequired","Queue service is required")),priority:l.Yj({required_error:e("priorityIsRequired","Priority is required")}).trim().min(1,e("priorityIsRequired","Priority is required"))})}(y)},[y]),T=(0,h.l)(),O=T.queueLocations,j=T.isLoading,A=(0,n.useMemo)(function(){return O},[JSON.stringify(O.map(function(e){return{id:e.id,name:e.name}}))]),C=(0,s.useSession)().sessionLocation,k=(0,s.useConfig)(),Q=k.concepts,x=Q.defaultStatusConceptUuid,L=Q.defaultPriorityConceptUuid,I=Q.emergencyPriorityConceptUuid,F=k.visitQueueNumberAttributeUuid,_=(0,p.R7)().currentServiceQueueUuid,M=(0,b.fe)().mutateQueueEntries,D=(0,o.mN)({defaultValues:{priority:L,queueLocation:(null===(t=A[0])||void 0===t?void 0:t.id)||"",queueService:""},mode:"onChange",resolver:(0,c.u)(q)}),U=D.control,R=D.formState.errors,V=D.setValue,B=D.trigger,W=D.watch,N=W("queueLocation"),$=W("queueService"),Y=W("priority"),G=(0,g.A)(N),J=G.queues,z=G.isLoading,H=(0,n.useMemo)(function(){return J},[JSON.stringify(J.map(function(e){return{uuid:e.uuid,name:e.name}}))]),K=null!==(d=null===(r=J.find(function(e){return e.uuid===$}))||void 0===r?void 0:r.allowedPriorities)&&void 0!==d?d:[],X=Y===I?1:0,Z=(0,n.useCallback)(function(e){return(t=function(){var t;return function(e,t){var r,n,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(u=0)),u;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){u.label=a[1];break}if(6===a[0]&&u.label<i[1]){u.label=i[1],i=a;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(a);break}i[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,function(r){switch(r.label){case 0:return[4,B(["queueLocation","queueService","priority"])];case 1:return r.sent()?[2,v(e.uuid,$,e.patient.uuid,Y,x,X,N,F).then(function(){(0,s.showSnackbar)({kind:"success",isLowContrast:!0,title:y("addedPatientToQueue","Added patient to queue"),subtitle:y("queueEntryAddedSuccessfully","Queue entry added successfully")}),M()}).catch(function(e){throw(0,s.showSnackbar)({title:y("queueEntryError","Error adding patient to the queue"),kind:"error",isLowContrast:!1,subtitle:null==e?void 0:e.message}),e})]:(t=Object.entries(R).map(function(e){var t,r,n,i=(r=e,n=2,function(e){if(Array.isArray(e))return e}(r)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return u}}(r,n)||function(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[1];return"".concat(null!==(t=null==i?void 0:i.message)&&void 0!==t?t:"Invalid")}).join("\n"),[2,Promise.reject(new Error("Form validation failed:\n".concat(t)))])}})},function(){var e=this,r=arguments;return new Promise(function(n,i){var u=t.apply(e,r);function o(e){w(u,n,i,o,a,"next",e)}function a(e){w(u,n,i,o,a,"throw",e)}o(void 0)})})();var t},[x,M,Y,N,$,X,y,B,F,R]);return(0,n.useEffect)(function(){null==f||f(Z)},[Z,f]),(0,n.useEffect)(function(){_&&V("queueService",_,{shouldValidate:!0})},[_,V]),(0,n.useEffect)(function(){if(m){var e=H.find(function(e){return e.name===m});V("queueService",null==e?void 0:e.uuid,{shouldValidate:!0})}},[m,H,V]),(0,n.useEffect)(function(){A.map(function(e){return e.id}).includes(C.uuid)&&V("queueLocation",C.uuid,{shouldValidate:!0})},[A,C.uuid,V]),i().createElement(u.BJc,{gap:5},i().createElement(s.ResponsiveWrapper,null,i().createElement(u.gE_,{legendText:y("queueLocation","Queue Location")},i().createElement(o.xI,{name:"queueLocation",control:U,render:function(e){var t,r=e.field;return j?i().createElement(u.aB4,null):i().createElement(u.l6P,P(S({},r),{labelText:"",id:"queueLocation",invalid:!!R.queueLocation,invalidText:null===(t=R.queueLocation)||void 0===t?void 0:t.message,onChange:function(e){return r.onChange(e.target.value)}}),i().createElement(u.ebT,{text:y("selectQueueLocation","Select a queue location"),value:""}),null==A?void 0:A.map(function(e){return i().createElement(u.ebT,{key:e.id,text:e.name,value:e.id},e.name)}))}}))),i().createElement(u.gE_,{legendText:y("service","Service")},i().createElement(o.xI,{name:"queueService",control:U,render:function(e){var t,r=e.field;return z?i().createElement(u.aB4,null):(null==J?void 0:J.length)?i().createElement(u.l6P,P(S({},r),{labelText:"",id:"queueService",invalid:!!R.queueService,invalidText:null===(t=R.queueService)||void 0===t?void 0:t.message,onChange:function(e){return r.onChange(e.target.value)}}),i().createElement(u.ebT,{text:y("selectQueueService","Select a queue service"),value:""}),null==J?void 0:J.map(function(e){return i().createElement(u.ebT,{key:e.uuid,text:e.name,value:e.uuid},e.name)})):i().createElement(u.jeF,{kind:"error",lowContrast:!0,subtitle:y("configureServices","Please configure services to continue."),title:y("noServicesConfigured","No services configured")})}})),$&&i().createElement(u.gE_,{legendText:y("priority","Priority")},i().createElement(o.xI,{name:"priority",control:U,render:function(e){var t=e.field;return z?i().createElement(u.zWQ,null,i().createElement(u.Psq,null),i().createElement(u.Psq,null),i().createElement(u.Psq,null)):(null==K?void 0:K.length)?i().createElement(u.zWQ,P(S({},t),{id:"priority",valueSelected:t.value,onChange:function(e){return t.onChange(e)}}),K.map(function(e){var t=e.uuid,r=e.display;return i().createElement(u.aaP,{key:t,labelText:r,value:t})})):i().createElement(u.jeF,{kind:"error",lowContrast:!0,title:y("noPrioritiesForServiceTitle","No priorities available")},y("noPrioritiesForService","The selected service does not have any allowed priorities. This is an error in configuration. Please contact your system administrator."))}})))})},65845:(e,t,r)=>{r.d(t,{R7:()=>o,dV:()=>u});var n=r(90380),i=(0,n.createContext)({currentServiceQueueUuid:""}),u=i.Provider,o=function(){var e=(0,n.useContext)(i);if(!e)throw new Error("useAddPatientToQueueContext must be used within a AddPatientToQueueContextProvider");return e}},66985:(e,t,r)=>{r.d(t,{l:()=>u});var n=r(90380),i=r(38254);function u(){var e="".concat(i.fhirBaseUrl,"/Location?_summary=data&_tag=queue location"),t=(0,i.useFhirFetchAll)(e),r=t.data,u=t.error,o=t.isLoading;return{queueLocations:(0,n.useMemo)(function(){var e;return null!==(e=null==r?void 0:r.map(function(e){return e}).sort(function(e,t){return e.name.localeCompare(t.name,(0,i.getLocale)())}))&&void 0!==e?e:[]},[r]),isLoading:o,error:u}}},71638:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var n=r(90380),i=r.n(n),u=r(85689),o=r(93150),a=r(71123),l=r(38254),c=r(51751),s=r(21364);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,u=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const m=function(e){var t=e.modalTitle,r=e.activeVisit,a=e.closeModal,d=(0,o.useTranslation)().t,m=(0,c.fe)().mutateQueueEntries,y=(0,l.useConfig)(),v=f((0,n.useState)(!1),2),p=v[0],b=v[1],h=f((0,n.useState)(null),2),g=h[0],E=h[1],w=(0,n.useCallback)(function(e){var t,n,i,u;e.preventDefault(),b(!0),null==g||null===(u=g.submitQueueEntry)||void 0===u||null===(i=u.call(g,r))||void 0===i||null===(n=i.then(function(){a(),m()}))||void 0===n||null===(t=n.catch(function(e){(0,l.showSnackbar)({title:d("queueEntryError","Error adding patient to the queue"),kind:"error",isLowContrast:!1,subtitle:null==e?void 0:e.message})}))||void 0===t||t.finally(function(){b(!1)})},[g,r,a,m,d]);return i().createElement(u.lVW,{onSubmit:w},i().createElement(u.rQ0,{closeModal:a,title:t}),i().createElement(u.cwr,null,i().createElement(s.A,{setOnSubmit:function(e){return E({submitQueueEntry:e})},defaultInitialServiceQueue:y.defaultInitialServiceQueue})),i().createElement(u.jlY,null,i().createElement(u.$nd,{kind:"secondary",onClick:a},d("cancel","Cancel")),i().createElement(u.$nd,{disabled:p,kind:"primary",type:"submit"},p?d("addingPatientToQueue","Adding patient to queue")+"...":d("addPatientToQueue","Add patient to queue"))))};var y=r(3728);const v=function(e){var t,r=e.closeModal,n=e.activeVisit,c=null==n||null===(t=n.patient)||void 0===t?void 0:t.uuid,s=(0,o.useTranslation)().t,d=function(e){var t,r,n=encodeURIComponent("custom:(uuid,display,queue:(uuid,display,name,location:(uuid,display),service:(uuid,display),allowedPriorities:(uuid,display),allowedStatuses:(uuid,display)),status,patient:(uuid,display),visit:(uuid,display,startDatetime),priority,priorityComment,sortWeight,startedAt,endedAt,locationWaitingFor,queueComingFrom,providerWaitingFor,previousQueueEntry)"),i="".concat(l.restBaseUrl,"/queue-entry?v=").concat(n,"&patient=").concat(e,"&isEnded=false"),u=(0,a.Ay)(i,l.openmrsFetch),o=u.data,c=u.error,s=u.isLoading,d=u.mutate;return{data:(null==o||null===(r=o.data)||void 0===r||null===(t=r.results)||void 0===t?void 0:t.reduce(function(e,t){return!e||new Date(t.startedAt)>new Date(e.startedAt)?t:e},null))||null,error:c,isLoading:s,mutate:d}}(c),f=d.data,v=d.isLoading,p=d.error;return v?i().createElement(u.dF7,null):p?i().createElement(u.jeF,{kind:"error",title:s("errorLoadingQueueEntry","Error loading queue entry"),subtitle:(null==p?void 0:p.message)||s("unexpectedError","An unexpected error occurred"),lowContrast:!0}):i().createElement(i().Fragment,null,f?i().createElement(y.default,{queueEntry:f,closeModal:r}):i().createElement(m,{modalTitle:s("addPatientToQueue","Add patient to queue"),activeVisit:n,closeModal:r}))}}}]);