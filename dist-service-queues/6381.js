"use strict";(globalThis.webpackChunk_openmrs_esm_service_queues_app=globalThis.webpackChunk_openmrs_esm_service_queues_app||[]).push([[6381],{1677:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(96956),u=n(84089),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;const a=function(e,t){if((0,r.A)(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!(0,u.A)(e))||o.test(e)||!i.test(e)||null!=t&&e in Object(t)}},9322:(e,t,n)=>{n.d(t,{A:()=>u});var r=n(84089);const u=function(e){if("string"==typeof e||(0,r.A)(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},14151:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e){return e}},26861:(e,t,n)=>{n.d(t,{E9:()=>c,YR:()=>l,cv:()=>d,i6:()=>s,yn:()=>f});var r=n(54440);function u(e,t){null==t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t)}function i(e){return sessionStorage.getItem(e)}var o={selectedQueueLocationName:i("queueLocationName"),selectedQueueLocationUuid:i("queueLocationUuid"),selectedServiceUuid:i("queueServiceUuid"),selectedServiceDisplay:i("queueServiceDisplay"),selectedQueueStatusUuid:i("queueStatusUuid"),selectedQueueStatusDisplay:i("queueStatusDisplay")},a=(0,r.createGlobalStore)("serviceQueues",o),l=function(e,t){u("queueServiceUuid",e),u("queueServiceDisplay",t),a.setState({selectedServiceUuid:e,selectedServiceDisplay:t})},c=function(e){u("queueLocationName",e),a.setState({selectedQueueLocationName:e})},s=function(e){u("queueLocationUuid",e),a.setState({selectedQueueLocationUuid:e})},f=function(e,t){u("queueStatusUuid",e),u("queueStatusDisplay",t),a.setState({selectedQueueStatusUuid:e,selectedQueueStatusDisplay:t})};function d(){return(0,r.useStore)(a)}},50942:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(54440),u=n(88010),i=n.n(u),o=n(1343);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){var t,n="".concat(r.restBaseUrl,"/queue?v=").concat("custom:(uuid,display,name,description,service:(uuid,display),allowedPriorities:(uuid,display),allowedStatuses:(uuid,display),location:(uuid,display))")+(e?"&location=".concat(e):""),u=i()(n,r.openmrsFetch),l=u.data,c=function(e,t){if(null==e)return{};var n,r,u=function(e,t){if(null==e)return{};var n,r,u={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(u[n]=e[n]);return u}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}(u,["data"]),s=(0,o.useMemo)(function(){var e,t;return null!==(t=null==l||null===(e=l.data)||void 0===e?void 0:e.results.sort(function(e,t){return e.display.localeCompare(t.display,(0,r.getLocale)())}))&&void 0!==t?t:[]},[null==l||null===(t=l.data)||void 0===t?void 0:t.results]);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}({queues:s},c)}},51751:(e,t,n)=>{n.d(t,{Mu:()=>g,Z0:()=>m,fe:()=>p});var r=n(1343),u=n(42853),i=n(71123),o=n(55434),a=n(54440);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,u,i=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){a=!0,u=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw u}}return i}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}var d="".concat(a.restBaseUrl,"/queue-entry"),v="custom:(uuid,display,queue,status,patient:(uuid,display,person,identifiers:(uuid,display,identifier,identifierType)),visit:(uuid,display,startDatetime,encounters:(uuid,display,diagnoses,encounterDatetime,encounterType,obs,encounterProviders,voided),attributes:(uuid,display,value,attributeType)),priority,priorityComment,sortWeight,startedAt,endedAt,locationWaitingFor,queueComingFrom,providerWaitingFor,previousQueueEntry)";function y(e,t){var n=new URLSearchParams;if(n.append("v",e),n.append("totalCount","true"),t){var r=!0,u=!1,i=void 0;try{for(var o,a=Object.entries(t)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=c(o.value,2),s=l[0],f=l[1];null!=f&&n.append(s,null==f?void 0:f.toString())}}catch(e){u=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(u)throw i}}}return"".concat(d,"?").concat(n.toString())}function p(){var e=(0,o.useSWRConfig)().mutate;return{mutateQueueEntries:function(){return e(function(e){return"string"==typeof e&&(e.includes("".concat(a.restBaseUrl,"/queue-entry"))||e.includes("".concat(a.restBaseUrl,"/visit-queue-entry")))}).then(function(){window.dispatchEvent(new CustomEvent("queue-entry-updated"))})}}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,n=p().mutateQueueEntries,o=c((0,r.useState)(0),2),l=o[0],f=o[1],d=c((0,r.useState)(t),2),m=d[0],g=d[1],h=c((0,r.useState)(e),2),b=h[0],A=h[1],S=c((0,r.useState)([]),2),w=S[0],q=S[1],E=c((0,r.useState)(void 0),2),C=E[0],U=E[1],O=c((0,r.useState)(y(m,b)),2),j=O[0],L=O[1],I=c((0,r.useState)(0),2),Q=I[0],T=I[1],D=c((0,r.useState)(!1),2),k=D[0],P=D[1],_=(0,r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;P(!0),f(0),L(y(e,t))},[m,b]);(0,r.useEffect)(function(){var n=!(0,u.A)(b,e),r=m!==t;(n||r)&&(n&&A(e),r&&g(t),_(t,e))},[m,b,_,t,e,A]);var x=(0,i.Ay)(j,a.openmrsFetch),M=x.data,W=x.isValidating,F=x.error;(0,r.useEffect)(function(){var e=function(e){var t,n,r=null==e||null===(n=e.data)||void 0===n||null===(t=n.links)||void 0===t?void 0:t.find(function(e){return"next"===e.rel});if(r){var u=new URL(r.uri);return u.origin===window.location.origin?u.toString():new URL("".concat(u.pathname).concat(u.search?u.search:""),window.location.origin).toString()}return null}(M),t=k&&!W;if(k&&W&&P(!1),M&&!W&&!t){var n,r,u,i;if((null==M||null===(n=M.data)||void 0===n?void 0:n.totalCount)>-1&&(null==M||null===(r=M.data)||void 0===r?void 0:r.totalCount)!==Q&&T(null==M||null===(i=M.data)||void 0===i?void 0:i.totalCount),null==M||null===(u=M.data)||void 0===u?void 0:u.results){var o,a=s(w);a[l]=null==M||null===(o=M.data)||void 0===o?void 0:o.results,q(a)}f(l+1),L(e),w.length>l&&e&&P(!0)}e||w.length>l+1&&q(function(e){var t=s(e);return t.splice(l+1),t})},[M,w,l,Q,k,W]),(0,r.useEffect)(function(){F&&U(F)},[F]);var R=(0,r.useCallback)(function(){_()},[_]);(0,r.useEffect)(function(){return window.addEventListener("queue-entry-updated",R),function(){window.removeEventListener("queue-entry-updated",R)}},[R]);var B=(0,r.useMemo)(function(){return w.flat()},[w]);return{queueEntries:B,totalCount:Q,isLoading:void 0===Q||Q&&B.length<Q,isValidating:W||l<w.length,error:C,mutate:n}}function g(e){var t,n,r=new URLSearchParams,u=!0,o=!1,l=void 0;try{for(var s,f=Object.entries(e)[Symbol.iterator]();!(u=(s=f.next()).done);u=!0){var d=c(s.value,2),v=d[0],y=d[1];null!=y&&r.append(v,null==y?void 0:y.toString())}}catch(e){o=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(o)throw l}}var p="".concat(a.restBaseUrl,"/queue-entry-metrics?")+r.toString(),m=(0,i.Ay)(p,a.openmrsFetch).data;return{count:m?null==m||null===(t=m.data)||void 0===t?void 0:t.count:0,averageWaitTime:null==m||null===(n=m.data)||void 0===n?void 0:n.averageWaitTime}}},55841:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(85861),u=n(9322);const i=function(e,t){for(var n=0,i=(t=(0,r.A)(t,e)).length;null!=e&&n<i;)e=e[(0,u.A)(t[n++])];return n&&n==i?e:void 0}},56381:(e,t,n)=>{n.r(t),n.d(t,{default:()=>z});var r=n(1343),u=n.n(r),i=n(72339),o=n(15680),a=n(54440),l=n(8050),c=n(61031),s=n(51751),f=n(50942),d=n(39791),v=n(43944);var y=n(97942);const p=function(e){return e==e&&!(0,y.A)(e)};var m=n(7817);const g=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},h=function(e){var t=function(e){for(var t=(0,m.A)(e),n=t.length;n--;){var r=t[n],u=e[r];t[n]=[r,u,p(u)]}return t}(e);return 1==t.length&&t[0][2]?g(t[0][0],t[0][1]):function(n){return n===e||function(e,t,n,r){var u=n.length,i=u,o=!r;if(null==e)return!i;for(e=Object(e);u--;){var a=n[u];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++u<i;){var l=(a=n[u])[0],c=e[l],s=a[1];if(o&&a[2]){if(void 0===c&&!(l in e))return!1}else{var f=new d.A;if(r)var y=r(c,s,l,e,t,f);if(!(void 0===y?(0,v.A)(s,c,3,r,f):y))return!1}}return!0}(n,e,t)}};var b=n(55841);const A=function(e,t){return null!=e&&t in Object(e)};var S=n(85861),w=n(61697),q=n(96956),E=n(85378),C=n(47893),U=n(9322);const O=function(e,t){return null!=e&&function(e,t,n){for(var r=-1,u=(t=(0,S.A)(t,e)).length,i=!1;++r<u;){var o=(0,U.A)(t[r]);if(!(i=null!=e&&n(e,o)))break;e=e[o]}return i||++r!=u?i:!!(u=null==e?0:e.length)&&(0,C.A)(u)&&(0,E.A)(o,u)&&((0,q.A)(e)||(0,w.A)(e))}(e,t,A)};var j=n(1677);const L=function(e,t){return(0,j.A)(e)&&p(t)?g((0,U.A)(e),t):function(n){var r=function(e,t,n){var r=null==e?void 0:(0,b.A)(e,t);return void 0===r?n:r}(n,e);return void 0===r&&r===t?O(n,e):(0,v.A)(t,r,3)}};var I=n(14151);const Q=function(e){return(0,j.A)(e)?(t=(0,U.A)(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return(0,b.A)(t,e)}}(e);var t};var T=n(34149);const D=function(e){return e!=e},k=function(e,t){return!(null==e||!e.length)&&function(e,t,n){return t==t?function(e,t,n){for(var r=n-1,u=e.length;++r<u;)if(e[r]===t)return r;return-1}(e,t,n):function(e,t,n,r){for(var u=e.length,i=n+(r?1:-1);r?i--:++i<u;)if(t(e[i],i,e))return i;return-1}(e,D,n)}(e,t,0)>-1},P=function(e,t,n){for(var r=-1,u=null==e?0:e.length;++r<u;)if(n(t,e[r]))return!0;return!1};var _=n(62026),x=n(28574);var M=n(39922);const W=x.A&&1/(0,M.A)(new x.A([,-0]))[1]==1/0?function(e){return new x.A(e)}:function(){},F=function(e,t){return e&&e.length?function(e,t,n){var r=-1,u=k,i=e.length,o=!0,a=[],l=a;if(n)o=!1,u=P;else if(i>=200){var c=t?null:W(e);if(c)return(0,M.A)(c);o=!1,u=_.A,l=new T.A}else l=t?[]:a;e:for(;++r<i;){var s=e[r],f=t?t(s):s;if(s=n||0!==s?s:0,o&&f==f){for(var d=l.length;d--;)if(l[d]===f)continue e;t&&l.push(f),a.push(s)}else u(l,f,n)||(l!==a&&l.push(f),a.push(s))}return a}(e,"function"==typeof(n=t)?n:null==n?I.A:"object"==typeof n?(0,q.A)(n)?L(n[0],n[1]):h(n):Q(n)):[];var n};var R=n(26861);const B=function(){var e=(0,R.cv)().selectedQueueLocationUuid,t=(0,f.A)(e),n=t.queues,u=t.isLoading;return(0,r.useMemo)(function(){return{services:F(n.flatMap(function(e){return e.service}),function(e){return null==e?void 0:e.uuid}).sort(function(e,t){return e.display.localeCompare(t.display,(0,a.getLocale)())}),isLoadingQueueServices:u}},[n,u])};function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(e,t):void 0}}function z(){var e,t=(0,i.useTranslation)().t,n=(0,a.useLayoutType)(),f=(0,R.cv)(),d=f.selectedServiceUuid,v=f.selectedServiceDisplay,y=f.selectedQueueLocationUuid,p=B().services,m=(0,c.vW)(d,y).serviceCount,g=(0,a.useConfig)().concepts.defaultStatusConceptUuid,h={display:"".concat(t("all","All"))},b=[h].concat(function(e){if(Array.isArray(e))return $(e)}(e=null!=p?p:[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||N(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),A=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,u,i=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){a=!0,u=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw u}}return i}}(e,t)||N(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((0,r.useState)(function(){return!v||!d}),2),S=A[0],w=A[1],q=(0,s.Z0)({service:d,location:y,isEnded:!1,status:g}),E=q.totalCount,C=q.queueEntries.filter(function(e){var t,n;return"urgent"===(null===(n=e.priority)||void 0===n||null===(t=n.display)||void 0===t?void 0:t.toLowerCase())}).length;return u().createElement(l.C,null,u().createElement(l.Jq,{title:t("waitingFor","Waiting for")+":"},u().createElement(o.msM,{id:"inline",initialSelectedItem:h,items:b,itemToString:function(e){var t;return e?"".concat(e.display," ").concat((null===(t=e.location)||void 0===t?void 0:t.display)?"- ".concat(e.location.display):""):""},label:"",onChange:function(e){var t=e.selectedItem;(0,R.YR)(t.uuid,t.display),void 0===t.uuid?w(!0):w(!1)},size:(0,a.isDesktop)(n)?"sm":"lg",type:"inline"})),u().createElement(l.OC,null,u().createElement(l.dL,{label:t("patients","Patients"),value:S?null!=E?E:"--":m}),u().createElement(l.dL,{label:t("urgent","Urgent"),value:C>0?C:null,color:"red",small:!0})))}},60587:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(83516),u=n(65133),i=n(96956),o=n(84089),a=r.A?r.A.prototype:void 0,l=a?a.toString:void 0;const c=function e(t){if("string"==typeof t)return t;if((0,i.A)(t))return(0,u.A)(t,e)+"";if((0,o.A)(t))return l?l.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n},s=function(e){return null==e?"":c(e)}},65133:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e,t){for(var n=-1,r=null==e?0:e.length,u=Array(r);++n<r;)u[n]=t(e[n],n,e);return u}},84089:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(62135),u=n(47313);const i=function(e){return"symbol"==typeof e||(0,u.A)(e)&&"[object Symbol]"==(0,r.A)(e)}},85861:(e,t,n)=>{n.d(t,{A:()=>v});var r=n(96956),u=n(1677),i=n(29240);function o(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,u=t?t.apply(this,r):r[0],i=n.cache;if(i.has(u))return i.get(u);var o=e.apply(this,r);return n.cache=i.set(u,o)||i,o};return n.cache=new(o.Cache||i.A),n}o.Cache=i.A;var a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/\\(\\)?/g;const c=(s=o(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(a,function(e,n,r,u){t.push(r?u.replace(l,"$1"):n||e)}),t},function(e){return 500===f.size&&f.clear(),e}),f=s.cache,s);var s,f,d=n(60587);const v=function(e,t){return(0,r.A)(e)?e:(0,u.A)(e,t)?[e]:c((0,d.A)(e))}}}]);