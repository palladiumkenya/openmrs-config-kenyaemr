"use strict";(globalThis.webpackChunk_openmrs_esm_service_queues_app=globalThis.webpackChunk_openmrs_esm_service_queues_app||[]).push([[7067],{21364:(e,t,n)=>{n.d(t,{A:()=>P});var r=n(90380),i=n.n(r),u=n(85689),o=n(80824),a=n(93150),l=n(68580),c=n(81160),s=n(38254);function d(e,t,n,r,i,u,o){try{var a=e[u](o),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var u=e.apply(t,n);function o(e){d(u,r,i,o,a,"next",e)}function a(e){d(u,r,i,o,a,"throw",e)}o(void 0)})}}function v(e,t){var n,r,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(u=0)),u;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){u.label=a[1];break}if(6===a[0]&&u.label<i[1]){u.label=i[1],i=a;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(a);break}i[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function p(e,t,n,r){return f(function(){var i;return v(this,function(u){switch(u.label){case 0:return i=new AbortController,[4,(0,s.openmrsFetch)("".concat(s.restBaseUrl,"/queue-entry-number?location=").concat(e,"&queue=").concat(n,"&visit=").concat(t,"&visitAttributeType=").concat(r),{method:"GET",headers:{"Content-Type":"application/json"},signal:i.signal})];case 1:return u.sent(),[2]}})})()}function y(e,t,n,r,i,u,o,a){return f(function(){var l;return v(this,function(c){switch(c.label){case 0:return l=new AbortController,[4,Promise.all([p(o,e,t,a)])];case 1:return c.sent(),[2,(0,s.openmrsFetch)("".concat(s.restBaseUrl,"/visit-queue-entry"),{method:"POST",headers:{"Content-Type":"application/json"},signal:l.signal,body:{visit:{uuid:e},queueEntry:{status:{uuid:i},priority:{uuid:r},queue:{uuid:t},patient:{uuid:n},startedAt:new Date,sortWeight:u}}})]}})})()}var m=n(65845),b=n(51751),h=n(66985),g=n(50942);function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t,n,r,i,u,o){try{var a=e[u](o),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){q(e,t,n[t])})}return e}function O(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const P=i().memo(function(e){var t,n,d,f=e.setOnSubmit,v=e.defaultInitialServiceQueue,p=(0,a.useTranslation)().t,q=(0,r.useMemo)(function(){return function(e){return l.Ik({queueLocation:l.Yj({required_error:e("queueLocationRequired","Queue location is required")}).trim().min(1,e("queueLocationRequired","Queue location is required")),queueService:l.Yj({required_error:e("queueServiceRequired","Queue service is required")}).trim().min(1,e("queueServiceRequired","Queue service is required")),priority:l.Yj({required_error:e("priorityIsRequired","Priority is required")}).trim().min(1,e("priorityIsRequired","Priority is required"))})}(p)},[p]),P=(0,h.l)(),C=P.queueLocations,j=P.isLoading,A=(0,r.useMemo)(function(){return C},[JSON.stringify(C.map(function(e){return{id:e.id,name:e.name}}))]),T=(0,s.useSession)().sessionLocation,x=(0,s.useConfig)(),L=x.concepts,k=L.defaultStatusConceptUuid,Q=L.defaultPriorityConceptUuid,I=L.emergencyPriorityConceptUuid,U=x.visitQueueNumberAttributeUuid,F=(0,m.R7)().currentServiceQueueUuid,_=(0,b.fe)().mutateQueueEntries,R=(0,o.mN)({defaultValues:{priority:Q,queueLocation:(null===(t=A[0])||void 0===t?void 0:t.id)||"",queueService:""},mode:"onChange",resolver:(0,c.u)(q)}),B=R.control,V=R.formState.errors,W=R.setValue,M=R.trigger,D=R.watch,N=D("queueLocation"),G=D("queueService"),J=D("priority"),Y=(0,g.A)(N),z=Y.queues,$=Y.isLoading,Z=(0,r.useMemo)(function(){return z},[JSON.stringify(z.map(function(e){return{uuid:e.uuid,name:e.name}}))]),H=null!==(d=null===(n=z.find(function(e){return e.uuid===G}))||void 0===n?void 0:n.allowedPriorities)&&void 0!==d?d:[],K=J===I?1:0,X=(0,r.useCallback)(function(e){return(t=function(){var t;return function(e,t){var n,r,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(u=0)),u;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){u.label=a[1];break}if(6===a[0]&&u.label<i[1]){u.label=i[1],i=a;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(a);break}i[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,function(n){switch(n.label){case 0:return[4,M(["queueLocation","queueService","priority"])];case 1:return n.sent()?[2,y(e.uuid,G,e.patient.uuid,J,k,K,N,U).then(function(){(0,s.showSnackbar)({kind:"success",isLowContrast:!0,title:p("addedPatientToQueue","Added patient to queue"),subtitle:p("queueEntryAddedSuccessfully","Queue entry added successfully")}),_()}).catch(function(e){throw(0,s.showSnackbar)({title:p("queueEntryError","Error adding patient to the queue"),kind:"error",isLowContrast:!1,subtitle:null==e?void 0:e.message}),e})]:(t=Object.entries(V).map(function(e){var t,n,r,i=(n=e,r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,u=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(u.push(r.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return u}}(n,r)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[1];return"".concat(null!==(t=null==i?void 0:i.message)&&void 0!==t?t:"Invalid")}).join("\n"),[2,Promise.reject(new Error("Form validation failed:\n".concat(t)))])}})},function(){var e=this,n=arguments;return new Promise(function(r,i){var u=t.apply(e,n);function o(e){S(u,r,i,o,a,"next",e)}function a(e){S(u,r,i,o,a,"throw",e)}o(void 0)})})();var t},[k,_,J,N,G,K,p,M,U,V]);return(0,r.useEffect)(function(){null==f||f(X)},[X,f]),(0,r.useEffect)(function(){F&&W("queueService",F,{shouldValidate:!0})},[F,W]),(0,r.useEffect)(function(){if(v){var e=Z.find(function(e){return e.name===v});W("queueService",null==e?void 0:e.uuid,{shouldValidate:!0})}},[v,Z,W]),(0,r.useEffect)(function(){A.map(function(e){return e.id}).includes(T.uuid)&&W("queueLocation",T.uuid,{shouldValidate:!0})},[A,T.uuid,W]),i().createElement(u.BJc,{gap:5},i().createElement(s.ResponsiveWrapper,null,i().createElement(u.gE_,{legendText:p("queueLocation","Queue Location")},i().createElement(o.xI,{name:"queueLocation",control:B,render:function(e){var t,n=e.field;return j?i().createElement(u.aB4,null):i().createElement(u.l6P,O(E({},n),{labelText:"",id:"queueLocation",invalid:!!V.queueLocation,invalidText:null===(t=V.queueLocation)||void 0===t?void 0:t.message,onChange:function(e){return n.onChange(e.target.value)}}),i().createElement(u.ebT,{text:p("selectQueueLocation","Select a queue location"),value:""}),null==A?void 0:A.map(function(e){return i().createElement(u.ebT,{key:e.id,text:e.name,value:e.id},e.name)}))}}))),i().createElement(u.gE_,{legendText:p("service","Service")},i().createElement(o.xI,{name:"queueService",control:B,render:function(e){var t,n=e.field;return $?i().createElement(u.aB4,null):(null==z?void 0:z.length)?i().createElement(u.l6P,O(E({},n),{labelText:"",id:"queueService",invalid:!!V.queueService,invalidText:null===(t=V.queueService)||void 0===t?void 0:t.message,onChange:function(e){return n.onChange(e.target.value)}}),i().createElement(u.ebT,{text:p("selectQueueService","Select a queue service"),value:""}),null==z?void 0:z.map(function(e){return i().createElement(u.ebT,{key:e.uuid,text:e.name,value:e.uuid},e.name)})):i().createElement(u.jeF,{kind:"error",lowContrast:!0,subtitle:p("configureServices","Please configure services to continue."),title:p("noServicesConfigured","No services configured")})}})),G&&i().createElement(u.gE_,{legendText:p("priority","Priority")},i().createElement(o.xI,{name:"priority",control:B,render:function(e){var t=e.field;return $?i().createElement(u.zWQ,null,i().createElement(u.Psq,null),i().createElement(u.Psq,null),i().createElement(u.Psq,null)):(null==H?void 0:H.length)?i().createElement(u.zWQ,O(E({},t),{id:"priority",valueSelected:t.value,onChange:function(e){return t.onChange(e)}}),H.map(function(e){var t=e.uuid,n=e.display;return i().createElement(u.aaP,{key:t,labelText:n,value:t})})):i().createElement(u.jeF,{kind:"error",lowContrast:!0,title:p("noPrioritiesForServiceTitle","No priorities available")},p("noPrioritiesForService","The selected service does not have any allowed priorities. This is an error in configuration. Please contact your system administrator."))}})))})},42853:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(43944);const i=function(e,t){return(0,r.A)(e,t)}},47067:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var r=n(38254),i=n(90380),u=n.n(i),o=n(21364);const a=function(e){var t=(0,r.useConfig)(),n=e.setVisitFormCallbacks,i=e.visitFormOpenedFrom;return e.patientChartConfig.showServiceQueueFields||"service-queues-add-patient"==i?u().createElement(o.A,{setOnSubmit:function(e){return n({onVisitCreatedOrUpdated:e})},defaultInitialServiceQueue:t.defaultInitialServiceQueue}):u().createElement(u().Fragment,null)}},50942:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(38254),i=n(88010),u=n.n(i),o=n(90380);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){var t,n="".concat(r.restBaseUrl,"/queue?v=").concat("custom:(uuid,display,name,description,service:(uuid,display),allowedPriorities:(uuid,display),allowedStatuses:(uuid,display),location:(uuid,display))")+(e?"&location=".concat(e):""),i=u()(n,r.openmrsFetch),l=i.data,c=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},u=Object.keys(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(i,["data"]),s=(0,o.useMemo)(function(){var e,t;return null!==(t=null==l||null===(e=l.data)||void 0===e?void 0:e.results.sort(function(e,t){return e.display.localeCompare(t.display,(0,r.getLocale)())}))&&void 0!==t?t:[]},[null==l||null===(t=l.data)||void 0===t?void 0:t.results]);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}({queues:s},c)}},51751:(e,t,n)=>{n.d(t,{Mu:()=>b,Z0:()=>m,fe:()=>y});var r=n(90380),i=n(42853),u=n(71123),o=n(55434),a=n(38254);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,u=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(u.push(r.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return u}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}var f="".concat(a.restBaseUrl,"/queue-entry"),v="custom:(uuid,display,queue,status,patient:(uuid,display,person,identifiers:(uuid,display,identifier,identifierType)),visit:(uuid,display,startDatetime,encounters:(uuid,display,diagnoses,encounterDatetime,encounterType,obs,encounterProviders,voided),attributes:(uuid,display,value,attributeType)),priority,priorityComment,sortWeight,startedAt,endedAt,locationWaitingFor,queueComingFrom,providerWaitingFor,previousQueueEntry)";function p(e,t){var n=new URLSearchParams;if(n.append("v",e),n.append("totalCount","true"),t){var r=!0,i=!1,u=void 0;try{for(var o,a=Object.entries(t)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=c(o.value,2),s=l[0],d=l[1];null!=d&&n.append(s,null==d?void 0:d.toString())}}catch(e){i=!0,u=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw u}}}return"".concat(f,"?").concat(n.toString())}function y(){var e=(0,o.useSWRConfig)().mutate;return{mutateQueueEntries:function(){return e(function(e){return"string"==typeof e&&(e.includes("".concat(a.restBaseUrl,"/queue-entry"))||e.includes("".concat(a.restBaseUrl,"/visit-queue-entry")))}).then(function(){window.dispatchEvent(new CustomEvent("queue-entry-updated"))})}}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,n=y().mutateQueueEntries,o=c((0,r.useState)(0),2),l=o[0],d=o[1],f=c((0,r.useState)(t),2),m=f[0],b=f[1],h=c((0,r.useState)(e),2),g=h[0],w=h[1],S=c((0,r.useState)([]),2),q=S[0],E=S[1],O=c((0,r.useState)(void 0),2),P=O[0],C=O[1],j=c((0,r.useState)(p(m,g)),2),A=j[0],T=j[1],x=c((0,r.useState)(0),2),L=x[0],k=x[1],Q=c((0,r.useState)(!1),2),I=Q[0],U=Q[1],F=(0,r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g;U(!0),d(0),T(p(e,t))},[m,g]);(0,r.useEffect)(function(){var n=!(0,i.A)(g,e),r=m!==t;(n||r)&&(n&&w(e),r&&b(t),F(t,e))},[m,g,F,t,e,w]);var _=(0,u.Ay)(A,a.openmrsFetch),R=_.data,B=_.isValidating,V=_.error;(0,r.useEffect)(function(){var e=function(e){var t,n,r=null==e||null===(n=e.data)||void 0===n||null===(t=n.links)||void 0===t?void 0:t.find(function(e){return"next"===e.rel});if(r){var i=new URL(r.uri);return i.origin===window.location.origin?i.toString():new URL("".concat(i.pathname).concat(i.search?i.search:""),window.location.origin).toString()}return null}(R),t=I&&!B;if(I&&B&&U(!1),R&&!B&&!t){var n,r,i,u;if((null==R||null===(n=R.data)||void 0===n?void 0:n.totalCount)>-1&&(null==R||null===(r=R.data)||void 0===r?void 0:r.totalCount)!==L&&k(null==R||null===(u=R.data)||void 0===u?void 0:u.totalCount),null==R||null===(i=R.data)||void 0===i?void 0:i.results){var o,a=s(q);a[l]=null==R||null===(o=R.data)||void 0===o?void 0:o.results,E(a)}d(l+1),T(e),q.length>l&&e&&U(!0)}e||q.length>l+1&&E(function(e){var t=s(e);return t.splice(l+1),t})},[R,q,l,L,I,B]),(0,r.useEffect)(function(){V&&C(V)},[V]);var W=(0,r.useCallback)(function(){F()},[F]);(0,r.useEffect)(function(){return window.addEventListener("queue-entry-updated",W),function(){window.removeEventListener("queue-entry-updated",W)}},[W]);var M=(0,r.useMemo)(function(){return q.flat()},[q]);return{queueEntries:M,totalCount:L,isLoading:void 0===L||L&&M.length<L,isValidating:B||l<q.length,error:P,mutate:n}}function b(e){var t,n,r=new URLSearchParams,i=!0,o=!1,l=void 0;try{for(var s,d=Object.entries(e)[Symbol.iterator]();!(i=(s=d.next()).done);i=!0){var f=c(s.value,2),v=f[0],p=f[1];null!=p&&r.append(v,null==p?void 0:p.toString())}}catch(e){o=!0,l=e}finally{try{i||null==d.return||d.return()}finally{if(o)throw l}}var y="".concat(a.restBaseUrl,"/queue-entry-metrics?")+r.toString(),m=(0,u.Ay)(y,a.openmrsFetch).data;return{count:m?null==m||null===(t=m.data)||void 0===t?void 0:t.count:0,averageWaitTime:null==m||null===(n=m.data)||void 0===n?void 0:n.averageWaitTime}}},65845:(e,t,n)=>{n.d(t,{R7:()=>o,dV:()=>u});var r=n(90380),i=(0,r.createContext)({currentServiceQueueUuid:""}),u=i.Provider,o=function(){var e=(0,r.useContext)(i);if(!e)throw new Error("useAddPatientToQueueContext must be used within a AddPatientToQueueContextProvider");return e}},66985:(e,t,n)=>{n.d(t,{l:()=>u});var r=n(90380),i=n(38254);function u(){var e="".concat(i.fhirBaseUrl,"/Location?_summary=data&_tag=queue location"),t=(0,i.useFhirFetchAll)(e),n=t.data,u=t.error,o=t.isLoading;return{queueLocations:(0,r.useMemo)(function(){var e;return null!==(e=null==n?void 0:n.map(function(e){return e}).sort(function(e,t){return e.name.localeCompare(t.name,(0,i.getLocale)())}))&&void 0!==e?e:[]},[n]),isLoading:o,error:u}}}}]);