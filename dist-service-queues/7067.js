(globalThis.webpackChunk_openmrs_esm_service_queues_app=globalThis.webpackChunk_openmrs_esm_service_queues_app||[]).push([[7067],{21364:(e,t,n)=>{"use strict";n.d(t,{A:()=>L});var r=n(1343),i=n.n(r),u=n(15680),o=n(80824),a=n(72339),s=n(68580),c=n(81160),l=n(54440);function d(e,t,n,r,i,u,o){try{var a=e[u](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var u=e.apply(t,n);function o(e){d(u,r,i,o,a,"next",e)}function a(e){d(u,r,i,o,a,"throw",e)}o(void 0)})}}function v(e,t){var n,r,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(u=0)),u;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){u.label=a[1];break}if(6===a[0]&&u.label<i[1]){u.label=i[1],i=a;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(a);break}i[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function h(e,t,n,r){return f(function(){var i;return v(this,function(u){switch(u.label){case 0:return i=new AbortController,[4,(0,l.openmrsFetch)("".concat(l.restBaseUrl,"/queue-entry-number?location=").concat(e,"&queue=").concat(n,"&visit=").concat(t,"&visitAttributeType=").concat(r),{method:"GET",headers:{"Content-Type":"application/json"},signal:i.signal})];case 1:return u.sent(),[2]}})})()}function p(e,t,n,r,i,u,o,a){return f(function(){var s;return v(this,function(c){switch(c.label){case 0:return s=new AbortController,[4,Promise.all([h(o,e,t,a)])];case 1:return c.sent(),[2,(0,l.openmrsFetch)("".concat(l.restBaseUrl,"/visit-queue-entry"),{method:"POST",headers:{"Content-Type":"application/json"},signal:s.signal,body:{visit:{uuid:e},queueEntry:{status:{uuid:i},priority:{uuid:r},queue:{uuid:t},patient:{uuid:n},startedAt:new Date,sortWeight:u}}})]}})})()}var y=n(51751),m=n(66985),b=n(50942),g=n(57691),S=n(26861);function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function q(e,t,n,r,i,u,o){try{var a=e[u](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,i)}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){$(e,t,n[t])})}return e}function E(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const L=i().memo(function(e){var t=e.setOnSubmit,n=e.defaultInitialServiceQueue,d=(0,a.useTranslation)().t,f=(0,r.useMemo)(function(){return s.Ik({queueLocation:s.Yj().trim(),queueService:s.Yj().trim(),priority:s.Yj().trim().optional().or(s.eu(""))})},[d]),v=(0,l.useSession)().sessionLocation,h=(0,m.l)(),$=h.queueLocations,L=h.isLoading,k=(0,r.useMemo)(function(){return $.map(function(e){return{id:e.id,name:e.name}})},[$]),D=(0,l.useConfig)(),C=D.concepts,M=C.defaultStatusConceptUuid,j=(C.defaultPriorityConceptUuid,C.emergencyPriorityConceptUuid),T=D.visitQueueNumberAttributeUuid,P=(0,S.cv)().selectedServiceUuid,A=(0,y.fe)().mutateQueueEntries,x=(0,o.mN)({defaultValues:{priority:"",queueLocation:"",queueService:""},mode:"onChange",resolver:(0,c.u)(f)}),U=x.control,_=x.formState,I=_.errors,F=_.touchedFields,Q=_.isSubmitted,V=x.setValue,Y=x.trigger,W=x.watch,B=x.getValues,H=x.clearErrors,N=W("queueLocation"),R=W("queueService"),Z=W("priority"),z=(0,b.A)(N),J=z.queues,G=z.isLoading,K=(0,r.useMemo)(function(){return J.map(function(e){return{uuid:e.uuid,name:e.name,allowedPriorities:e.allowedPriorities}})},[J]),X=(0,r.useMemo)(function(){var e,t;return null!==(t=null===(e=K.find(function(e){return e.uuid===R}))||void 0===e?void 0:e.allowedPriorities)&&void 0!==t?t:[]},[K,R]),ee=Z===j?1:0,te=!L&&!G,ne=N&&R,re=(0,r.useCallback)(function(e){return(t=function(){var t,n,r,i,u,o;return function(e,t){var n,r,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(u=0)),u;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){u.label=a[1];break}if(6===a[0]&&u.label<i[1]){u.label=i[1],i=a;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(a);break}i[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),ne?[3,2]:N?[4,Y(["queueLocation","queueService","priority"])]:[2,Promise.resolve()];case 1:if(!a.sent())throw t=Object.entries(I).map(function(e){var t,n,r,i=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,u=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(u.push(r.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return u}}(n,r)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],o=i[1];return"".concat(u,": ").concat(null!==(t=null==o?void 0:o.message)&&void 0!==t?t:"Invalid")}).join("\n"),(0,l.showSnackbar)({title:d("formValidationFailed","Form validation failed"),kind:"error",isLowContrast:!1,subtitle:t}),new Error("Form validation failed:\n".concat(t));a.label=2;case 2:if(n=B(),N&&!n.queueService)throw r=[d("service","Service")],i=d("missingRequiredFields","Missing required fields: {{fields}}",{fields:r.join(", ")}),(0,l.showSnackbar)({title:d("incompleteForm","Incomplete form"),kind:"error",isLowContrast:!1,subtitle:i}),new Error(i);return n.queueLocation&&n.queueService?[2,p(e.uuid,n.queueService,e.patient.uuid,n.priority||"",M,ee,n.queueLocation,T).then(function(){(0,l.showSnackbar)({kind:"success",isLowContrast:!0,title:d("addedPatientToQueue","Added patient to queue"),subtitle:d("queueEntryAddedSuccessfully","Queue entry added successfully")}),A()}).catch(function(e){var t,n,r;throw((null==e||null===(n=e.responseBody)||void 0===n||null===(t=n.error)||void 0===t?void 0:t.message)||(null==e?void 0:e.message)||"").includes(g.m6)?(0,l.showSnackbar)({title:d("patientAlreadyInQueue","Patient already in queue"),kind:"warning",isLowContrast:!1,subtitle:d("duplicateQueueEntry","This patient is already in the selected queue.")}):(0,l.showSnackbar)({title:d("queueEntryError","Error adding patient to the queue"),kind:"error",isLowContrast:!1,subtitle:null!==(r=null==e?void 0:e.message)&&void 0!==r?r:d("unknownError","An unknown error occurred")}),e})]:[2,Promise.resolve()];case 3:throw u=a.sent(),(0,l.showSnackbar)({title:d("unexpectedError","Unexpected error"),kind:"error",isLowContrast:!1,subtitle:null!==(o=null==u?void 0:u.message)&&void 0!==o?o:d("unknownError","An unknown error occurred")}),u;case 4:return[2]}})},function(){var e=this,n=arguments;return new Promise(function(r,i){var u=t.apply(e,n);function o(e){q(u,r,i,o,a,"next",e)}function a(e){q(u,r,i,o,a,"throw",e)}o(void 0)})})();var t},[M,A,ee,d,Y,T,I,B,ne,N]);return(0,r.useEffect)(function(){null==t||t(re)},[re,t]),(0,r.useEffect)(function(){var e=B("queueLocation");(null==v?void 0:v.uuid)&&!e&&!F.queueLocation&&k.length>0&&k.some(function(e){return e.id===v.uuid})&&V("queueLocation",v.uuid,{shouldValidate:te})},[v,k,B,F.queueLocation,V,te]),(0,r.useEffect)(function(){var e=B("queueService");!P||e||F.queueService||V("queueService",P,{shouldValidate:te})},[P,B,F.queueService,V,te]),(0,r.useEffect)(function(){if(n&&K.length>0&&!R&&N){var e=K.find(function(e){return e.name===n});e&&R!==e.uuid&&V("queueService",e.uuid,{shouldValidate:te})}},[n,K,R,V,te,N]),(0,r.useEffect)(function(){N&&R&&(K.some(function(e){return e.uuid===R})||(V("queueService","",{shouldValidate:te}),V("priority","",{shouldValidate:te})))},[N,K,R,V,te]),(0,r.useEffect)(function(){R&&0!==X.length||(V("priority","",{shouldValidate:!1}),H("priority"))},[R,X,V,H]),(0,r.useEffect)(function(){N||(V("queueService","",{shouldValidate:!1}),V("priority","",{shouldValidate:!1}),H(["queueService","priority"]))},[N,V,H]),i().createElement(u.BJc,{gap:5},i().createElement(l.ResponsiveWrapper,null,i().createElement(u.gE_,{legendText:d("queueLocation","Queue Location")},i().createElement(o.xI,{name:"queueLocation",control:U,render:function(e){var t,n=e.field;return L?i().createElement(u.aB4,null):i().createElement(u.l6P,E(O({},n),{labelText:"",id:"queueLocation",invalid:!!I.queueLocation&&(F.queueLocation||Q),invalidText:null===(t=I.queueLocation)||void 0===t?void 0:t.message,onChange:function(e){n.onChange(e.target.value),e.target.value!==N&&(V("queueService","",{shouldValidate:!1}),V("priority","",{shouldValidate:!1}),H(["queueService","priority"]))}}),i().createElement(u.ebT,{text:d("selectQueueLocation","Select a queue location"),value:""}),null==k?void 0:k.map(function(e){return i().createElement(u.ebT,{key:e.id,text:e.name,value:e.id},e.name)}))}}))),N&&i().createElement(u.gE_,{legendText:d("service","Service")},i().createElement(o.xI,{name:"queueService",control:U,render:function(e){var t,n=e.field;return G?i().createElement(u.aB4,null):(null==K?void 0:K.length)?i().createElement(u.l6P,E(O({},n),{labelText:"",id:"queueService",invalid:!!I.queueService&&(F.queueService||Q),invalidText:null===(t=I.queueService)||void 0===t?void 0:t.message,onChange:function(e){n.onChange(e.target.value),e.target.value!==R&&(V("priority","",{shouldValidate:!1}),H("priority"))}}),i().createElement(u.ebT,{text:d("selectQueueService","Select a queue service"),value:""}),null==K?void 0:K.map(function(e){return i().createElement(u.ebT,{key:e.uuid,text:e.name,value:e.uuid},e.name)})):i().createElement(u.jeF,{kind:"error",lowContrast:!0,subtitle:d("configureServices","Please configure services to continue."),title:d("noServicesConfigured","No services configured")})}})),N&&R&&i().createElement(u.gE_,{legendText:d("priority","Priority")},i().createElement(o.xI,{name:"priority",control:U,render:function(e){var t=e.field;return G?i().createElement(u.zWQ,null,i().createElement(u.Psq,null),i().createElement(u.Psq,null),i().createElement(u.Psq,null)):(null==X?void 0:X.length)?i().createElement(u.zWQ,E(O({},t),{id:"priority",valueSelected:t.value,onChange:function(e){return t.onChange(e)}}),X.map(function(e){var t=e.uuid,n=e.display;return i().createElement(u.aaP,{key:t,labelText:n,value:t})})):i().createElement(u.jeF,{kind:"error",lowContrast:!0,title:d("noPrioritiesForServiceTitle","No priorities available")},d("noPrioritiesForService","The selected service does not have any allowed priorities. This is an error in configuration. Please contact your system administrator."))}})))})},23464:function(e){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",r="second",i="minute",u="hour",o="day",a="week",s="month",c="quarter",l="year",d="date",f="Invalid Date",v=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},y=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},m={s:y,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+y(r,2,"0")+":"+y(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,s),u=n-i<0,o=t.clone().add(r+(u?-1:1),s);return+(-(r+(n-i)/(u?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:s,y:l,w:a,d:o,D:d,h:u,m:i,s:r,ms:n,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",g={};g[b]=p;var S="$isDayjsObject",w=function(e){return e instanceof E||!(!e||!e[S])},q=function e(t,n,r){var i;if(!t)return b;if("string"==typeof t){var u=t.toLowerCase();g[u]&&(i=u),n&&(g[u]=n,i=u);var o=t.split("-");if(!i&&o.length>1)return e(o[0])}else{var a=t.name;g[a]=t,i=a}return!r&&i&&(b=i),i||!r&&b},$=function(e,t){if(w(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new E(n)},O=m;O.l=q,O.i=w,O.w=function(e,t){return $(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function p(e){this.$L=q(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[S]=!0}var y=p.prototype;return y.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(O.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(v);if(r){var i=r[2]-1||0,u=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,u)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,u)}}return new Date(t)}(e),this.init()},y.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},y.$utils=function(){return O},y.isValid=function(){return!(this.$d.toString()===f)},y.isSame=function(e,t){var n=$(e);return this.startOf(t)<=n&&n<=this.endOf(t)},y.isAfter=function(e,t){return $(e)<this.startOf(t)},y.isBefore=function(e,t){return this.endOf(t)<$(e)},y.$g=function(e,t,n){return O.u(e)?this[t]:this.set(n,e)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(e,t){var n=this,c=!!O.u(t)||t,f=O.p(e),v=function(e,t){var r=O.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return c?r:r.endOf(o)},h=function(e,t){return O.w(n.toDate()[e].apply(n.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},p=this.$W,y=this.$M,m=this.$D,b="set"+(this.$u?"UTC":"");switch(f){case l:return c?v(1,0):v(31,11);case s:return c?v(1,y):v(0,y+1);case a:var g=this.$locale().weekStart||0,S=(p<g?p+7:p)-g;return v(c?m-S:m+(6-S),y);case o:case d:return h(b+"Hours",0);case u:return h(b+"Minutes",1);case i:return h(b+"Seconds",2);case r:return h(b+"Milliseconds",3);default:return this.clone()}},y.endOf=function(e){return this.startOf(e,!1)},y.$set=function(e,t){var a,c=O.p(e),f="set"+(this.$u?"UTC":""),v=(a={},a[o]=f+"Date",a[d]=f+"Date",a[s]=f+"Month",a[l]=f+"FullYear",a[u]=f+"Hours",a[i]=f+"Minutes",a[r]=f+"Seconds",a[n]=f+"Milliseconds",a)[c],h=c===o?this.$D+(t-this.$W):t;if(c===s||c===l){var p=this.clone().set(d,1);p.$d[v](h),p.init(),this.$d=p.set(d,Math.min(this.$D,p.daysInMonth())).$d}else v&&this.$d[v](h);return this.init(),this},y.set=function(e,t){return this.clone().$set(e,t)},y.get=function(e){return this[O.p(e)]()},y.add=function(n,c){var d,f=this;n=Number(n);var v=O.p(c),h=function(e){var t=$(f);return O.w(t.date(t.date()+Math.round(e*n)),f)};if(v===s)return this.set(s,this.$M+n);if(v===l)return this.set(l,this.$y+n);if(v===o)return h(1);if(v===a)return h(7);var p=(d={},d[i]=e,d[u]=t,d[r]=1e3,d)[v]||1,y=this.$d.getTime()+n*p;return O.w(y,this)},y.subtract=function(e,t){return this.add(-1*e,t)},y.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=O.z(this),u=this.$H,o=this.$m,a=this.$M,s=n.weekdays,c=n.months,l=n.meridiem,d=function(e,n,i,u){return e&&(e[n]||e(t,r))||i[n].slice(0,u)},v=function(e){return O.s(u%12||12,e,"0")},p=l||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(h,function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return O.s(t.$y,4,"0");case"M":return a+1;case"MM":return O.s(a+1,2,"0");case"MMM":return d(n.monthsShort,a,c,3);case"MMMM":return d(c,a);case"D":return t.$D;case"DD":return O.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(n.weekdaysMin,t.$W,s,2);case"ddd":return d(n.weekdaysShort,t.$W,s,3);case"dddd":return s[t.$W];case"H":return String(u);case"HH":return O.s(u,2,"0");case"h":return v(1);case"hh":return v(2);case"a":return p(u,o,!0);case"A":return p(u,o,!1);case"m":return String(o);case"mm":return O.s(o,2,"0");case"s":return String(t.$s);case"ss":return O.s(t.$s,2,"0");case"SSS":return O.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")})},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(n,d,f){var v,h=this,p=O.p(d),y=$(n),m=(y.utcOffset()-this.utcOffset())*e,b=this-y,g=function(){return O.m(h,y)};switch(p){case l:v=g()/12;break;case s:v=g();break;case c:v=g()/3;break;case a:v=(b-m)/6048e5;break;case o:v=(b-m)/864e5;break;case u:v=b/t;break;case i:v=b/e;break;case r:v=b/1e3;break;default:v=b}return f?v:O.a(v)},y.daysInMonth=function(){return this.endOf(s).$D},y.$locale=function(){return g[this.$L]},y.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=q(e,t,!0);return r&&(n.$L=r),n},y.clone=function(){return O.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},p}(),L=E.prototype;return $.prototype=L,[["$ms",n],["$s",r],["$m",i],["$H",u],["$W",o],["$M",s],["$y",l],["$D",d]].forEach(function(e){L[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),$.extend=function(e,t){return e.$i||(e(t,E,$),e.$i=!0),$},$.locale=q,$.isDayjs=w,$.unix=function(e){return $(1e3*e)},$.en=g[b],$.Ls=g,$.p={},$}()},26861:(e,t,n)=>{"use strict";n.d(t,{E9:()=>c,YR:()=>s,cv:()=>f,i6:()=>l,yn:()=>d});var r=n(54440);function i(e,t){null==t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t)}function u(e){return sessionStorage.getItem(e)}var o={selectedQueueLocationName:u("queueLocationName"),selectedQueueLocationUuid:u("queueLocationUuid"),selectedServiceUuid:u("queueServiceUuid"),selectedServiceDisplay:u("queueServiceDisplay"),selectedQueueStatusUuid:u("queueStatusUuid"),selectedQueueStatusDisplay:u("queueStatusDisplay")},a=(0,r.createGlobalStore)("serviceQueues",o),s=function(e,t){i("queueServiceUuid",e),i("queueServiceDisplay",t),a.setState({selectedServiceUuid:e,selectedServiceDisplay:t})},c=function(e){i("queueLocationName",e),a.setState({selectedQueueLocationName:e})},l=function(e){i("queueLocationUuid",e),a.setState({selectedQueueLocationUuid:e})},d=function(e,t){i("queueStatusUuid",e),i("queueStatusDisplay",t),a.setState({selectedQueueStatusUuid:e,selectedQueueStatusDisplay:t})};function f(){return(0,r.useStore)(a)}},47067:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(54440),i=n(1343),u=n.n(i),o=n(21364);const a=function(e){var t=(0,r.useConfig)(),n=e.setVisitFormCallbacks,i=e.visitFormOpenedFrom;return e.patientChartConfig.showServiceQueueFields||"service-queues-add-patient"==i?u().createElement(o.A,{setOnSubmit:function(e){return n({onVisitCreatedOrUpdated:e})},defaultInitialServiceQueue:t.defaultInitialServiceQueue}):u().createElement(u().Fragment,null)}},50942:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(54440),i=n(88010),u=n.n(i),o=n(1343);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t,n="".concat(r.restBaseUrl,"/queue?v=").concat("custom:(uuid,display,name,description,service:(uuid,display),allowedPriorities:(uuid,display),allowedStatuses:(uuid,display),location:(uuid,display))")+(e?"&location=".concat(e):""),i=u()(n,r.openmrsFetch),s=i.data,c=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},u=Object.keys(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(i,["data"]),l=(0,o.useMemo)(function(){var e,t;return null!==(t=null==s||null===(e=s.data)||void 0===e?void 0:e.results.sort(function(e,t){return e.display.localeCompare(t.display,(0,r.getLocale)())}))&&void 0!==t?t:[]},[null==s||null===(t=s.data)||void 0===t?void 0:t.results]);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}({queues:l},c)}},51751:(e,t,n)=>{"use strict";n.d(t,{Mu:()=>m,Z0:()=>y,fe:()=>p});var r=n(1343),i=n(42853),u=n(71123),o=n(55434),a=n(54440);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,u=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(u.push(r.value),!t||u.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return u}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}var f="".concat(a.restBaseUrl,"/queue-entry"),v="custom:(uuid,display,queue,status,patient:(uuid,display,person,identifiers:(uuid,display,identifier,identifierType)),visit:(uuid,display,startDatetime,encounters:(uuid,display,diagnoses,encounterDatetime,encounterType,obs,encounterProviders,voided),attributes:(uuid,display,value,attributeType)),priority,priorityComment,sortWeight,startedAt,endedAt,locationWaitingFor,queueComingFrom,providerWaitingFor,previousQueueEntry)";function h(e,t){var n=new URLSearchParams;if(n.append("v",e),n.append("totalCount","true"),t){var r=!0,i=!1,u=void 0;try{for(var o,a=Object.entries(t)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=c(o.value,2),l=s[0],d=s[1];null!=d&&n.append(l,null==d?void 0:d.toString())}}catch(e){i=!0,u=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw u}}}return"".concat(f,"?").concat(n.toString())}function p(){var e=(0,o.useSWRConfig)().mutate;return{mutateQueueEntries:function(){return e(function(e){return"string"==typeof e&&(e.includes("".concat(a.restBaseUrl,"/queue-entry"))||e.includes("".concat(a.restBaseUrl,"/visit-queue-entry")))}).then(function(){window.dispatchEvent(new CustomEvent("queue-entry-updated"))})}}}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,n=p().mutateQueueEntries,o=c((0,r.useState)(0),2),s=o[0],d=o[1],f=c((0,r.useState)(t),2),y=f[0],m=f[1],b=c((0,r.useState)(e),2),g=b[0],S=b[1],w=c((0,r.useState)([]),2),q=w[0],$=w[1],O=c((0,r.useState)(void 0),2),E=O[0],L=O[1],k=c((0,r.useState)(h(y,g)),2),D=k[0],C=k[1],M=c((0,r.useState)(0),2),j=M[0],T=M[1],P=c((0,r.useState)(!1),2),A=P[0],x=P[1],U=(0,r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g;x(!0),d(0),C(h(e,t))},[y,g]);(0,r.useEffect)(function(){var n=!(0,i.A)(g,e),r=y!==t;(n||r)&&(n&&S(e),r&&m(t),U(t,e))},[y,g,U,t,e,S]);var _=(0,u.Ay)(D,a.openmrsFetch),I=_.data,F=_.isValidating,Q=_.error;(0,r.useEffect)(function(){var e=function(e){var t,n,r=null==e||null===(n=e.data)||void 0===n||null===(t=n.links)||void 0===t?void 0:t.find(function(e){return"next"===e.rel});if(r){var i=new URL(r.uri);return i.origin===window.location.origin?i.toString():new URL("".concat(i.pathname).concat(i.search?i.search:""),window.location.origin).toString()}return null}(I),t=A&&!F;if(A&&F&&x(!1),I&&!F&&!t){var n,r,i,u;if((null==I||null===(n=I.data)||void 0===n?void 0:n.totalCount)>-1&&(null==I||null===(r=I.data)||void 0===r?void 0:r.totalCount)!==j&&T(null==I||null===(u=I.data)||void 0===u?void 0:u.totalCount),null==I||null===(i=I.data)||void 0===i?void 0:i.results){var o,a=l(q);a[s]=null==I||null===(o=I.data)||void 0===o?void 0:o.results,$(a)}d(s+1),C(e),q.length>s&&e&&x(!0)}e||q.length>s+1&&$(function(e){var t=l(e);return t.splice(s+1),t})},[I,q,s,j,A,F]),(0,r.useEffect)(function(){Q&&L(Q)},[Q]);var V=(0,r.useCallback)(function(){U()},[U]);(0,r.useEffect)(function(){return window.addEventListener("queue-entry-updated",V),function(){window.removeEventListener("queue-entry-updated",V)}},[V]);var Y=(0,r.useMemo)(function(){return q.flat()},[q]);return{queueEntries:Y,totalCount:j,isLoading:void 0===j||j&&Y.length<j,isValidating:F||s<q.length,error:E,mutate:n}}function m(e){var t,n,r=new URLSearchParams,i=!0,o=!1,s=void 0;try{for(var l,d=Object.entries(e)[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var f=c(l.value,2),v=f[0],h=f[1];null!=h&&r.append(v,null==h?void 0:h.toString())}}catch(e){o=!0,s=e}finally{try{i||null==d.return||d.return()}finally{if(o)throw s}}var p="".concat(a.restBaseUrl,"/queue-entry-metrics?")+r.toString(),y=(0,u.Ay)(p,a.openmrsFetch).data;return{count:y?null==y||null===(t=y.data)||void 0===t?void 0:t.count:0,averageWaitTime:null==y||null===(n=y.data)||void 0===n?void 0:n.averageWaitTime}}},57691:(e,t,n)=>{"use strict";n.d(t,{bn:()=>o,m6:()=>s,mL:()=>a,p1:()=>u});var r=n(23464),i=n.n(r),u=(window.getOpenmrsSpaBase,"".concat(window.spaBase,"/home")),o=(i()((new Date).setUTCHours(0,0,0,0)).format("YYYY-MM-DDTHH:mm:ss.SSSZZ"),Intl.DateTimeFormat().resolvedOptions().timeZone,"^(1[0-2]|0?[1-9]):[0-5][0-9]$"),a="create-queue-entry-workspace",s="[queue.entry.duplicate.patient]"},66985:(e,t,n)=>{"use strict";n.d(t,{l:()=>u});var r=n(1343),i=n(54440);function u(){var e="".concat(i.fhirBaseUrl,"/Location?_summary=data&_tag=queue location"),t=(0,i.useFhirFetchAll)(e),n=t.data,u=t.error,o=t.isLoading;return{queueLocations:(0,r.useMemo)(function(){var e;return null!==(e=null==n?void 0:n.map(function(e){return e}).sort(function(e,t){return e.name.localeCompare(t.name,(0,i.getLocale)())}))&&void 0!==e?e:[]},[n]),isLoading:o,error:u}}}}]);