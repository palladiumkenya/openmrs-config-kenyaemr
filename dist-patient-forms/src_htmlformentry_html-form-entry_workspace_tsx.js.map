{"version":3,"file":"src_htmlformentry_html-form-entry_workspace_tsx.js","mappings":"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","sources":["webpack://@openmrs/esm-patient-forms-app/./src/htmlformentry/html-form-entry-wrapper.scss","webpack://@openmrs/esm-patient-forms-app/./src/htmlformentry/html-form-entry-wrapper.scss?9aa7","webpack://@openmrs/esm-patient-forms-app/./src/htmlformentry/html-form-entry-wrapper.component.tsx","webpack://@openmrs/esm-patient-forms-app/./src/htmlformentry/html-form-entry.workspace.tsx"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/@openmrs/webpack-config/node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/@openmrs/webpack-config/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".-esm-patient-forms__html-form-entry-wrapper__wrapper___bkx4M {\\n  width: 95%;\\n  border: none;\\n  margin: 0;\\n  padding: 0;\\n  display: none;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/htmlformentry/html-form-entry-wrapper.scss\"],\"names\":[],\"mappings\":\"AAAA;EACE,UAAA;EACA,YAAA;EACA,SAAA;EACA,UAAA;EACA,aAAA;AACF\",\"sourcesContent\":[\".wrapper {\\n  width: 95%;\\n  border: none;\\n  margin: 0;\\n  padding: 0;\\n  display: none;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"wrapper\": \"-esm-patient-forms__html-form-entry-wrapper__wrapper___bkx4M\"\n};\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../../../node_modules/@openmrs/webpack-config/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../node_modules/@openmrs/webpack-config/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../node_modules/@openmrs/webpack-config/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../node_modules/@openmrs/webpack-config/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../node_modules/@openmrs/webpack-config/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../node_modules/@openmrs/webpack-config/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../node_modules/@openmrs/webpack-config/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[2].use[1]!../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[2]!./html-form-entry-wrapper.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\nif (module.hot) {\n  if (!content.locals || module.hot.invalidate) {\n    var isEqualLocals = function isEqualLocals(a, b, isNamedExport) {\n  if (!a && b || a && !b) {\n    return false;\n  }\n  var p;\n  for (p in a) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n    if (a[p] !== b[p]) {\n      return false;\n    }\n  }\n  for (p in b) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n    if (!a[p]) {\n      return false;\n    }\n  }\n  return true;\n};\n    var isNamedExport = !content.locals;\n    var oldLocals = isNamedExport ? namedExport : content.locals;\n\n    module.hot.accept(\n      \"!!../../../../node_modules/@openmrs/webpack-config/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[2].use[1]!../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[2]!./html-form-entry-wrapper.scss\",\n      function () {\n        if (!isEqualLocals(oldLocals, isNamedExport ? namedExport : content.locals, isNamedExport)) {\n                module.hot.invalidate();\n\n                return;\n              }\n\n              oldLocals = isNamedExport ? namedExport : content.locals;\n\n              update(content);\n      }\n    )\n  }\n\n  module.hot.dispose(function() {\n    update();\n  });\n}\n\n\nexport * from \"!!../../../../node_modules/@openmrs/webpack-config/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[2].use[1]!../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[2]!./html-form-entry-wrapper.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport styles from './html-form-entry-wrapper.scss';\nimport { InlineLoading } from '@carbon/react';\n\ninterface HtmlFormEntryWrapperProps {\n  closeWorkspaceWithSavedChanges: () => void;\n  src: string;\n}\n\nconst HtmlFormEntryWrapper: React.FC<HtmlFormEntryWrapperProps> = ({ closeWorkspaceWithSavedChanges, src }) => {\n  const iframeRef = useRef<HTMLIFrameElement>();\n  const [isIframeLoading, setIsIframeLoading] = useState(true);\n\n  // set up a listener to listen for a message from HFE-UI to close the workspace\n  useEffect(() => {\n    const callback = (event) => event?.data === 'close-workspace' && closeWorkspaceWithSavedChanges();\n    window.addEventListener('message', callback);\n    return () => window.removeEventListener('message', callback); // cleanup on unmount\n  }, [closeWorkspaceWithSavedChanges]);\n\n  // hide the headers and breadcrumbs of the O2 page on load\n  const onLoad = useCallback(() => {\n    setIsIframeLoading(false);\n    iframeRef.current.contentWindow.addEventListener('beforeunload', () => setIsIframeLoading(true));\n    const iframe = iframeRef.current;\n    const dashboard = iframeRef.current.contentDocument;\n    dashboard.querySelector('header')?.remove();\n    dashboard.querySelector('.patient-header')?.remove();\n    dashboard.querySelector('#breadcrumbs')?.remove();\n    iframe.style.display = 'block';\n    iframe.height = dashboard.body.scrollHeight + 50 + 'px'; // set iframe height to the height of the form, with some padding\n\n    const styleTag = dashboard.createElement('style');\n    styleTag.innerHTML = `@media screen {\n      body { background: white; }\n     }`;\n    dashboard.head.appendChild(styleTag);\n  }, []);\n\n  return (\n    <div>\n      {isIframeLoading && <InlineLoading />}\n      <iframe ref={iframeRef} src={src} className={styles.wrapper} onLoad={onLoad}></iframe>\n    </div>\n  );\n};\n\nexport default HtmlFormEntryWrapper;\n","import React from 'react';\nimport {\n  type DefaultPatientWorkspaceProps,\n  type FormEntryProps,\n  useVisitOrOfflineVisit,\n} from '@openmrs/esm-patient-common-lib';\nimport HtmlFormEntryWrapper from './html-form-entry-wrapper.component';\n\ninterface HtmlFormEntryComponentProps extends DefaultPatientWorkspaceProps {\n  formInfo: FormEntryProps;\n}\n\nconst HtmlFormEntry: React.FC<HtmlFormEntryComponentProps> = ({\n  patientUuid,\n  patient,\n  closeWorkspaceWithSavedChanges,\n  promptBeforeClosing,\n  formInfo,\n}) => {\n  const { currentVisit } = useVisitOrOfflineVisit(patientUuid);\n  const { encounterUuid, visitUuid, htmlForm } = formInfo || {};\n\n  // we always want to prompt the user before closing/hiding the workspace because we can't guarantee maintaining the state of the form\n  promptBeforeClosing(() => true);\n\n  // urls for entering a new form and editing an existing form; note that we specify the returnUrl as post-message:close-workspace,\n  // which tells HFE-UI to send a message to the parent window to close the workspace when the form is saved or cancelled\n\n  const uiPage = encounterUuid ? htmlForm.formEditUiPage : htmlForm.formUiPage;\n  const url = `${window.openmrsBase}/htmlformentryui/htmlform/${uiPage}.page?`;\n  const searchParams = new URLSearchParams();\n  searchParams.append('patientId', patientUuid);\n  if (visitUuid || currentVisit?.uuid) {\n    searchParams.append('visitId', visitUuid ?? currentVisit?.uuid);\n  }\n  if (encounterUuid) {\n    searchParams.append('encounterId', encounterUuid);\n  }\n  if (htmlForm.formUiResource) {\n    searchParams.append('definitionUiResource', htmlForm.formUiResource);\n  } else {\n    searchParams.append('formUuid', htmlForm.formUuid);\n  }\n  searchParams.append('returnUrl', 'post-message:close-workspace');\n\n  const showFormAndLoadedData = formInfo && patientUuid;\n  return (\n    <div>\n      {showFormAndLoadedData && (\n        <HtmlFormEntryWrapper\n          src={url + searchParams}\n          closeWorkspaceWithSavedChanges={closeWorkspaceWithSavedChanges}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default HtmlFormEntry;\n"],"names":["React","useCallback","useEffect","useRef","useState","styles","InlineLoading","HtmlFormEntryWrapper","closeWorkspaceWithSavedChanges","src","iframeRef","isIframeLoading","setIsIframeLoading","callback","event","data","window","addEventListener","removeEventListener","onLoad","dashboard","current","contentWindow","iframe","contentDocument","querySelector","remove","style","display","height","body","scrollHeight","styleTag","createElement","innerHTML","head","appendChild","div","ref","className","wrapper","useVisitOrOfflineVisit","HtmlFormEntry","patientUuid","patient","promptBeforeClosing","formInfo","currentVisit","encounterUuid","visitUuid","htmlForm","uiPage","formEditUiPage","formUiPage","url","openmrsBase","searchParams","URLSearchParams","append","uuid","formUiResource","formUuid","showFormAndLoadedData"],"sourceRoot":""}